<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WTSKF-GOA - Master the Art</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        /* Global Styles */
        :root {
            --primary: #d4af37;
            --dark: #121212;
            --darker: #0a0a0a;
            --light: #f8f9fa;
            --gray: #2a2a2a;
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
        }

        body {
            background-color: var(--dark);
            color: var(--light);
            line-height: 1.6;
            overflow-x: hidden;
        }

        .container {
            width: 100%;
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Navigation */
        .navbar {
            background: rgba(18, 18, 18, 0.9);
            backdrop-filter: blur(10px);
            position: fixed;
            width: 100%;
            padding: 1.2rem 0;
            z-index: 1000;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }

        .nav-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            color: var(--primary);
            font-size: 1.8rem;
            font-weight: 700;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logo i {
            color: var(--primary);
        }

        .nav-links {
            display: flex;
            gap: 2rem;
        }

        .nav-links a {
            color: var(--light);
            text-decoration: none;
            font-weight: 500;
            transition: var(--transition);
            position: relative;
        }

        .nav-links a:hover,
        .nav-links a.active {
            color: var(--primary);
        }

        .nav-links a::after {
            content: '';
            position: absolute;
            width: 0;
            height: 2px;
            background: var(--primary);
            bottom: -5px;
            left: 0;
            transition: var(--transition);
        }

        .nav-links a:hover::after,
        .nav-links a.active::after {
            width: 100%;
        }

        .auth-buttons {
            display: flex;
            gap: 1rem;
        }

        .btn {
            padding: 0.6rem 1.5rem;
            border-radius: 30px;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
            text-decoration: none;
            display: inline-block;
            text-align: center;
            border: 2px solid transparent;
        }

        .btn-primary {
            background: var(--primary);
            color: var(--dark);
        }

        .btn-primary:hover {
            background: transparent;
            border-color: var(--primary);
            color: var(--primary);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(212, 175, 55, 0.3);
        }

        .btn-outline {
            background: transparent;
            border: 2px solid var(--primary);
            color: var(--primary);
        }

        .btn-outline:hover {
            background: var(--primary);
            color: var(--dark);
            transform: translateY(-2px);
        }

        .hamburger {
            display: none;
            cursor: pointer;
            font-size: 1.5rem;
            color: var(--light);
        }

        /* Hero Section */
        .hero {
            position: relative;
            height: 100vh;
            background: #000;
            display: flex;
            align-items: center;
            text-align: center;
            padding-top: 80px;
            overflow: hidden;
        }

        .hero::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(rgba(0, 0, 0, 0.7), rgba(0, 0, 0, 0.7));
            z-index: 1;
        }

        .hero-video {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            z-index: 0;
        }

        .hero-content {
            position: relative;
            z-index: 2;
            max-width: 800px;
            margin: 0 auto;
            padding: 0 20px;
        }

    .hero h1 {
    font-size: 4rem;
    margin-bottom: 1.5rem;
    background: linear-gradient(45deg, #fff, var(--primary));
    background-clip: text;
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    line-height: 1.2;
}


        .hero p {
            font-size: 1.2rem;
            margin-bottom: 2rem;
            color: #ddd;
        }

        .tagline {
            display: flex;
            justify-content: center;
            gap: 1.5rem;
            margin-bottom: 2.5rem;
            font-size: 1.2rem;
            color: var(--primary);
            font-weight: 600;
        }

        .tagline span {
            position: relative;
        }

        .tagline span:not(:last-child)::after {
            content: 'â€¢';
            position: absolute;
            right: -1rem;
            color: var(--primary);
        }

        .cta-buttons {
            display: flex;
            justify-content: center;
            gap: 1.5rem;
            margin-top: 2rem;
        }

        /* Achievements Section */
        .achievements-section {
            padding: 80px 0;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 100%);
            position: relative;
            overflow: hidden;
        }

        /* Gallery Background Collage */
        .achievements-section::before {
            content: '';
            position: absolute;
            inset: 0;
            background-image: url('gallery/k1.jpg'), url('gallery/k2.jpg'), url('gallery/k3.jpg'), url('gallery/k6.jpg'), url('gallery/k7.jpg'), url('gallery/k8.jpg');
            background-size: 25% 25%;
            background-position: 0 0, 25% 0, 50% 0, 75% 0, 0 25%, 25% 25%;
            background-repeat: repeat;
            opacity: 0.08;
            z-index: 0;
            animation: collageFloat 60s linear infinite;
        }

        @keyframes collageFloat {
            0% { background-position: 0 0, 25% 0, 50% 0, 75% 0, 0 25%, 25% 25%; }
            100% { background-position: 100% 100%, 125% 100%, 150% 100%, 175% 100%, 100% 125%, 125% 125%; }
        }

        .achievements-inner { position: relative; z-index: 1; }

        /* Gallery/Video Toggle */
        .gallery-toggle {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-bottom: 2rem;
        }
        .gallery-toggle button {
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            color: #aaa;
            padding: 0.6rem 1.5rem;
            border-radius: 30px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.95rem;
        }
        .gallery-toggle button.active {
            background: var(--primary);
            color: var(--dark);
            border-color: var(--primary);
            font-weight: 500;
        }
        .gallery-toggle button:hover:not(.active) {
            background: rgba(255,255,255,0.08);
            border-color: rgba(255,255,255,0.2);
            color: #fff;
        }

        /* Gallery Grid */
        .gallery-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1.5rem;
            margin-bottom: 3rem;
        }
        .gallery-card {
            aspect-ratio: 1 / 1;
            border-radius: 12px;
            overflow: hidden;
            cursor: pointer;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            background: rgba(255,255,255,0.02);
            border: 1px solid rgba(255,255,255,0.05);
        }
        .gallery-card:hover {
            transform: scale(1.04);
            box-shadow: 0 8px 24px rgba(212,175,55,0.15);
            border-color: rgba(212,175,55,0.3);
        }
        .gallery-card img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
        }

        /* Video Grid */
        .video-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(400px, 1fr));
            gap: 2rem;
            margin-bottom: 3rem;
        }
        .video-card {
            background: rgba(255,255,255,0.03);
            border: 1px solid rgba(255,255,255,0.08);
            border-radius: 12px;
            overflow: hidden;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .video-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 32px rgba(212,175,55,0.12);
        }
        .video-card video {
            width: 100%;
            height: 240px;
            object-fit: cover;
            display: block;
        }
        .video-info {
            padding: 1rem;
            color: #ccc;
            text-align: center;
        }

        /* Slideshow Modal */
        .slideshow-modal {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.92);
            z-index: 2000;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 2rem;
        }
        .slideshow-modal.show { display: flex; }
        .slideshow-container {
            position: relative;
            max-width: 90vw;
            max-height: 90vh;
            margin: 0 auto;
        }
        .slideshow-image {
            max-width: 100%;
            max-height: 90vh;
            object-fit: contain;
            border-radius: 8px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.6);
        }
        .slideshow-nav {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            color: #fff;
            font-size: 1.5rem;
            padding: 0.8rem 1rem;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(8px);
        }
        .slideshow-nav:hover {
            background: rgba(212,175,55,0.2);
            border-color: var(--primary);
            color: var(--primary);
        }
        .slideshow-prev { left: 1rem; }
        .slideshow-next { right: 1rem; }
        .slideshow-close {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            color: #fff;
            font-size: 1.2rem;
            padding: 0.6rem 0.8rem;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(8px);
        }
        .slideshow-close:hover {
            background: rgba(212,175,55,0.2);
            border-color: var(--primary);
            color: var(--primary);
        }
        .slideshow-counter {
            position: absolute;
            bottom: 1rem;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.6);
            color: #fff;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.9rem;
            backdrop-filter: blur(8px);
        }

        @media (max-width: 768px) {
            .gallery-grid { grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 1rem; }
            .video-grid { grid-template-columns: 1fr; }
            .slideshow-nav { font-size: 1.2rem; padding: 0.6rem 0.8rem; }
            .slideshow-prev { left: 0.5rem; }
            .slideshow-next { right: 0.5rem; }
        }

        /* Login Section */
        .login-section {
            display: none;
            min-height: 100vh;
            padding: 120px 20px;
            background: linear-gradient(135deg, #0f0f0f 0%, #1a1a1a 100%);
        }

        .login-container {
            max-width: 450px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            padding: 3rem;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transform: translateY(20px);
            opacity: 0;
            animation: fadeInUp 0.6s ease forwards;
        }

        @keyframes fadeInUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .login-header {
            text-align: center;
            margin-bottom: 2.5rem;
        }

        .login-header h2 {
            font-size: 2.2rem;
            margin-bottom: 0.5rem;
            color: var(--primary);
        }

        .login-header p {
            color: #aaa;
        }

        .form-group {
            margin-bottom: 1.5rem;
            position: relative;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: #ddd;
            font-weight: 500;
        }

        .form-control {
            width: 100%;
            padding: 0.8rem 1rem;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            color: var(--light);
            font-size: 1rem;
            transition: var(--transition);
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(212, 175, 55, 0.2);
        }

        .forgot-password {
            display: block;
            text-align: right;
            margin-top: 0.5rem;
            color: #aaa;
            font-size: 0.9rem;
            text-decoration: none;
            transition: var(--transition);
        }

        .forgot-password:hover {
            color: var(--primary);
        }

        .btn-login {
            width: 100%;
            padding: 0.9rem;
            background: var(--primary);
            color: var(--dark);
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            margin-top: 1rem;
        }

        .btn-login:hover {
            background: #e6c44c;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(212, 175, 55, 0.3);
        }

        .divider {
            display: flex;
            align-items: center;
            margin: 2rem 0;
            color: #666;
            font-size: 0.9rem;
        }

        .divider::before,
        .divider::after {
            content: '';
            flex: 1;
            height: 1px;
            background: rgba(255, 255, 255, 0.1);
            margin: 0 1rem;
        }

        .social-login {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .btn-social {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.8rem;
            padding: 0.8rem;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
            border: 1px solid rgba(255, 255, 255, 0.1);
            background: rgba(255, 255, 255, 0.03);
            color: #fff;
        }

        .btn-social:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-2px);
        }

        .btn-social i {
            font-size: 1.2rem;
        }

        .register-link {
            text-align: center;
            margin-top: 2rem;
            color: #aaa;
        }

        .register-link a {
            color: var(--primary);
            text-decoration: none;
            font-weight: 500;
            margin-left: 0.3rem;
            transition: var(--transition);
        }

        .register-link a:hover {
            text-decoration: underline;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 10000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.8);
            backdrop-filter: blur(5px);
        }
        
        .modal-content {
            background-color: var(--dark);
            margin: 10% auto;
            padding: 0;
            border: 1px solid var(--primary);
            border-radius: 12px;
            width: 90%;
            max-width: 400px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            animation: modalSlideIn 0.3s ease-out;
        }
        
        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .modal-header {
            background: linear-gradient(135deg, var(--primary), #b8941f);
            color: white;
            padding: 20px;
            border-radius: 12px 12px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-header h3 {
            margin: 0;
            font-size: 1.3rem;
            font-weight: 600;
        }
        
        .close {
            color: white;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            line-height: 1;
            transition: var(--transition);
        }
        
        .close:hover {
            color: #ccc;
            transform: scale(1.1);
        }
        
        .modal-body {
            padding: 30px;
        }
        
        .modal-body .form-group {
            margin-bottom: 20px;
        }
        
        .modal-body label {
            display: block;
            margin-bottom: 8px;
            color: var(--light);
            font-weight: 500;
        }
        
        .modal-body .form-control {
            width: 100%;
            padding: 12px;
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(212,175,55,0.3);
            border-radius: 8px;
            color: var(--light);
            font-size: 1rem;
            transition: var(--transition);
        }
        
        .modal-body .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(212,175,55,0.1);
        }
        
        .modal-body .btn {
            width: 48%;
            padding: 12px;
            margin-top: 10px;
            font-weight: 600;
        }
        
        .modal-body .btn-primary {
            background: linear-gradient(135deg, var(--primary), #b8941f);
            border: none;
            color: white;
        }
        
        .modal-body .btn-cancel {
            background: transparent;
            border: 1px solid rgba(255,255,255,0.3);
            color: var(--light);
        }
        
        .modal-body .btn-cancel:hover {
            border-color: var(--primary);
            color: var(--primary);
        }

        /* Admin Dashboard */
        .dashboard {
            display: none;
            min-height: 100vh;
            background: #0f0f0f;
            padding-top: 80px;
        }

        .dashboard-container {
            display: flex;
            min-height: calc(100vh - 80px);
        }

        .sidebar {
            width: 280px;
            background: #121212;
            padding: 2rem 0;
            border-right: 1px solid rgba(255, 255, 255, 0.05);
            position: fixed;
            height: 100%;
            overflow-y: auto;
        }

        .sidebar-header {
            padding: 0 1.5rem 2rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            margin-bottom: 1.5rem;
        }

        .sidebar-header h3 {
            color: var(--primary);
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .sidebar-menu {
            padding: 0 1rem;
        }

        .menu-title {
            color: #666;
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin: 1.5rem 0 1rem 1rem;
        }

        .menu-item {
            display: flex;
            align-items: center;
            padding: 0.8rem 1rem;
            color: #aaa;
            text-decoration: none;
            border-radius: 8px;
            margin-bottom: 0.3rem;
            transition: var(--transition);
        }

        .menu-item i {
            margin-right: 0.8rem;
            font-size: 1.1rem;
            width: 20px;
            text-align: center;
        }

        .menu-item:hover,
        .menu-item.active {
            background: rgba(212, 175, 55, 0.1);
            color: var(--primary);
        }

        .menu-item.active {
            font-weight: 500;
        }

        .main-content {
            flex: 1;
            margin-left: 280px;
            padding: 2rem;
            background: #0a0a0a;
        }

        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .dashboard-header h1 {
            font-size: 1.8rem;
            color: #fff;
        }

        .user-profile {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--dark);
            font-weight: 600;
            cursor: pointer;
        }

        .user-name {
            font-weight: 500;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: #121212;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.05);
            transition: var(--transition);
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }

        .stat-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1rem;
        }

        .stat-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }

        .stat-1 .stat-icon {
            background: rgba(75, 192, 192, 0.1);
            color: #4bc0c0;
        }

        .stat-2 .stat-icon {
            background: rgba(54, 162, 235, 0.1);
            color: #36a2eb;
        }

        .stat-3 .stat-icon {
            background: rgba(255, 99, 132, 0.1);
            color: #ff6384;
        }

        .stat-4 .stat-icon {
            background: rgba(255, 159, 64, 0.1);
            color: #ff9f40;
        }

        .stat-value {
            font-size: 1.8rem;
            font-weight: 700;
            margin: 0.5rem 0;
            color: #fff;
        }

        .stat-title {
            color: #aaa;
            font-size: 0.9rem;
        }

        .stat-change {
            display: flex;
            align-items: center;
            font-size: 0.85rem;
            margin-top: 0.5rem;
        }

        .stat-change.positive {
            color: #4caf50;
        }

        .stat-change.negative {
            color: #f44336;
        }

        .stat-change i {
            margin-right: 0.3rem;
            font-size: 0.7rem;
        }

        .recent-activity {
            background: #121212;
            border-radius: 12px;
            padding: 1.5rem;
            margin-top: 2rem;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .section-title {
            font-size: 1.3rem;
            margin-bottom: 1.5rem;
            color: #fff;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .section-title i {
            color: var(--primary);
        }

        .activity-list {
            list-style: none;
        }

        .activity-item {
            display: flex;
            padding: 1rem 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .activity-item:last-child {
            border-bottom: none;
        }

        .activity-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(212, 175, 55, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 1rem;
            color: var(--primary);
            font-weight: 600;
        }

        .activity-content {
            flex: 1;
        }

        .activity-title {
            font-weight: 500;
            margin-bottom: 0.2rem;
            color: #fff;
        }

        .activity-desc {
            font-size: 0.85rem;
            color: #aaa;
            margin-bottom: 0.3rem;
        }

        .activity-time {
            font-size: 0.75rem;
            color: #666;
        }

        /* Admission Form */
        .admission-section {
            display: none;
            min-height: 100vh;
            padding: 120px 20px;
            background: linear-gradient(135deg, #0f0f0f 0%, #1a1a1a 100%);
        }

        .form-container {
            max-width: 800px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(10px);
            padding: 3rem;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .form-header {
            text-align: center;
            margin-bottom: 2.5rem;
        }

        .form-header h2 {
            font-size: 2.2rem;
            margin-bottom: 0.5rem;
            color: var(--primary);
        }

        .form-header p {
            color: #aaa;
        }

        .form-row {
            display: flex;
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .form-group.half {
            flex: 1;
        }

        .form-actions {
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
            margin-top: 2rem;
        }

        .btn-cancel {
            background: #333;
            color: #fff;
        }

        .btn-cancel:hover {
            background: #444;
        }

        .file-upload {
            position: relative;
            margin-bottom: 1.5rem;
        }

        .file-upload-label {
            display: block;
            padding: 1.5rem;
            border: 2px dashed rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
        }

        .file-upload-label:hover {
            border-color: var(--primary);
            background: rgba(212, 175, 55, 0.05);
        }

        .file-upload-icon {
            font-size: 2rem;
            color: var(--primary);
            margin-bottom: 0.5rem;
        }

        .file-upload-text {
            color: #aaa;
            margin-bottom: 0.5rem;
        }

        .file-upload-hint {
            font-size: 0.8rem;
            color: #666;
        }

        .file-upload-input {
            position: absolute;
            width: 0.1px;
            height: 0.1px;
            opacity: 0;
            overflow: hidden;
            z-index: -1;
        }

        /* Achievements Section */
        .achievements-section {
            display: none;
            min-height: 100vh;
            padding: 120px 20px;
            background: #0a0a0a;
        }

        .achievements-header {
            text-align: center;
            max-width: 700px;
            margin: 0 auto 3rem;
        }

        .section-subtitle {
            color: var(--primary);
            font-size: 1.1rem;
            margin-bottom: 1rem;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .section-title-large {
            font-size: 2.8rem;
            margin-bottom: 1.5rem;
            color: #fff;
            line-height: 1.2;
        }

        .section-description {
            color: #aaa;
            font-size: 1.1rem;
            line-height: 1.7;
        }

        .achievements-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 2rem;
            margin-bottom: 4rem;
        }

        .achievement-card {
            background: #121212;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            transition: var(--transition);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .achievement-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.3);
        }

        .achievement-image {
            height: 200px;
            overflow: hidden;
        }

        .achievement-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: var(--transition);
        }

        .achievement-card:hover .achievement-image img {
            transform: scale(1.05);
        }

        .achievement-content {
            padding: 1.5rem;
        }

        .achievement-date {
            display: inline-block;
            background: rgba(212, 175, 55, 0.1);
            color: var(--primary);
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            font-size: 0.8rem;
            margin-bottom: 0.8rem;
        }

        .achievement-title {
            font-size: 1.3rem;
            margin-bottom: 0.8rem;
            color: #fff;
        }

        .achievement-desc {
            color: #aaa;
            margin-bottom: 1.2rem;
            font-size: 0.95rem;
            line-height: 1.6;
        }

        .achievement-meta {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding-top: 1rem;
            border-top: 1px solid rgba(255, 255, 255, 0.05);
            font-size: 0.9rem;
        }

        .achievement-student {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: #aaa;
        }

        .student-avatar {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: #333;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            color: #fff;
        }

        .achievement-category {
            color: var(--primary);
            font-weight: 500;
        }

        .gallery-section {
            padding: 4rem 0;
        }

        .gallery-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 1.5rem;
        }

        .gallery-item {
            position: relative;
            border-radius: 10px;
            overflow: hidden;
            aspect-ratio: 1;
            cursor: pointer;
        }

        .gallery-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: var(--transition);
        }

        .gallery-item:hover img {
            transform: scale(1.05);
        }

        .gallery-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(to top, rgba(0, 0, 0, 0.8), transparent);
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            padding: 1.5rem;
            opacity: 0;
            transition: var(--transition);
        }

        .gallery-item:hover .gallery-overlay {
            opacity: 1;
        }

        .gallery-title {
            color: #fff;
            margin-bottom: 0.5rem;
            transform: translateY(20px);
            transition: var(--transition);
            transition-delay: 0.1s;
        }

        .gallery-category {
            color: var(--primary);
            font-size: 0.9rem;
            transform: translateY(20px);
            transition: var(--transition);
            transition-delay: 0.2s;
        }

        .gallery-item:hover .gallery-title,
        .gallery-item:hover .gallery-category {
            transform: translateY(0);
        }

        /* Enhanced Modal Forms */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .modal.show {
            display: flex;
            opacity: 1;
        }

        .modal-content {
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            max-width: 550px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5), 
                        0 0 0 1px rgba(255, 255, 255, 0.05);
            transform: translateY(-30px) scale(0.95);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
        }

        .modal.show .modal-content {
            transform: translateY(0) scale(1);
        }

        .modal-header {
            padding: 2rem 2rem 1rem 2rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.08);
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: rgba(255, 255, 255, 0.02);
            border-radius: 16px 16px 0 0;
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: #fff;
            margin: 0;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .modal-title::before {
            content: '';
            width: 4px;
            height: 24px;
            background: linear-gradient(135deg, var(--primary), #f4e4bc);
            border-radius: 2px;
        }

        .close-modal {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: #aaa;
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.2s ease;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .close-modal:hover {
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
            transform: scale(1.05);
        }

        .modal-body {
            padding: 2rem;
        }

        .modal-message {
            color: #ddd;
            margin-bottom: 1.5rem;
            line-height: 1.6;
        }

        .modal-footer {
            padding: 1rem 2rem 2rem 2rem;
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
            background: rgba(255, 255, 255, 0.02);
            border-radius: 0 0 16px 16px;
        }

        /* Enhanced Form Styles */
        .modal .form-group {
            margin-bottom: 1.5rem;
            position: relative;
        }

        .modal .form-section {
            margin-bottom: 2rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .modal .form-section:last-child {
            margin-bottom: 0;
            padding-bottom: 0;
            border-bottom: none;
        }

        .modal .section-subtitle {
            font-size: 1.1rem;
            color: var(--primary);
            margin: 0 0 1.5rem 0;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .modal .section-subtitle::before {
            content: '';
            width: 3px;
            height: 16px;
            background: var(--primary);
            border-radius: 2px;
        }

        .modal .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: #fff;
            font-weight: 500;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .modal .form-control {
            width: 100%;
            padding: 1rem 1.25rem;
            background: rgba(255, 255, 255, 0.08);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            color: #fff;
            font-size: 1rem;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .modal .form-control:focus {
            outline: none;
            border-color: var(--primary);
            background: rgba(255, 255, 255, 0.12);
            box-shadow: 0 0 0 4px rgba(212, 175, 55, 0.15),
                        0 4px 20px rgba(212, 175, 55, 0.1);
            transform: translateY(-2px);
        }

        .modal .form-control::placeholder {
            color: rgba(255, 255, 255, 0.4);
        }

        .modal .form-control[readonly] {
            background: rgba(255, 255, 255, 0.05);
            border-color: rgba(255, 255, 255, 0.15);
            color: #aaa;
            cursor: not-allowed;
        }

        .modal .form-row {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .modal .form-row .form-group {
            flex: 1;
            margin-bottom: 0;
        }

        /* Enhanced Buttons */
        .modal .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 10px;
            font-weight: 500;
            font-size: 0.95rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            position: relative;
            overflow: hidden;
        }

        .modal .btn-primary {
            background: linear-gradient(135deg, var(--primary), #f4e4bc);
            color: #000;
            box-shadow: 0 4px 15px rgba(212, 175, 55, 0.3);
        }

        .modal .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 25px rgba(212, 175, 55, 0.4);
        }

        .modal .btn-primary:active {
            transform: translateY(0);
        }

        .modal .btn-cancel {
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .modal .btn-cancel:hover {
            background: rgba(255, 255, 255, 0.15);
            border-color: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }

        /* Form validation styles */
        .modal .form-control:invalid {
            border-color: #e74c3c;
            box-shadow: 0 0 0 3px rgba(231, 76, 60, 0.1);
        }

        .modal .form-control:valid {
            border-color: #27ae60;
        }

        /* Loading state */
        .modal .btn.loading {
            opacity: 0.7;
            pointer-events: none;
        }

        .modal .btn.loading::after {
            content: '';
            position: absolute;
            width: 16px;
            height: 16px;
            border: 2px solid transparent;
            border-top: 2px solid currentColor;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-left: 8px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .modal-content {
                width: 95%;
                margin: 1rem;
                border-radius: 12px;
            }
            
            .modal-header,
            .modal-body,
            .modal-footer {
                padding-left: 1.5rem;
                padding-right: 1.5rem;
            }
            
            .modal .form-row {
                flex-direction: column;
                gap: 0;
            }
            
            .modal .form-row .form-group {
                margin-bottom: 1.5rem;
            }
        }

        /* Responsive Styles */
        @media (max-width: 992px) {
            .sidebar {
                width: 250px;
            }
            
            .main-content {
                margin-left: 250px;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 768px) {
            .nav-links {
                position: fixed;
                top: 80px;
                left: 0;
                width: 100%;
                background: #121212;
                flex-direction: column;
                align-items: center;
                padding: 1rem 0;
                gap: 0;
                box-shadow: 0 5px 10px rgba(0, 0, 0, 0.1);
                transform: translateY(-150%);
                transition: transform 0.3s ease;
                z-index: 999;
            }
            
            .nav-links.active {
                transform: translateY(0);
            }
            
            .nav-links a {
                padding: 1rem;
                width: 100%;
                text-align: center;
                border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            }
            
            .hamburger {
                display: block;
            }
            
            .auth-buttons {
                display: none;
            }
            
            .hero h1 {
                font-size: 2.8rem;
            }
            
            .tagline {
                flex-direction: column;
                gap: 0.5rem;
            }
            
            .tagline span:not(:last-child)::after {
                display: none;
            }
            
            .cta-buttons {
                flex-direction: column;
                gap: 1rem;
            }
            
            .btn {
                width: 100%;
            }
            
            .form-row {
                flex-direction: column;
                gap: 1rem;
            }
            
            .sidebar {
                transform: translateX(-100%);
                transition: transform 0.3s ease;
                z-index: 1001;
            }
            
            .sidebar.active {
                transform: translateX(0);
            }
            
            .main-content {
                margin-left: 0;
            }
            
            .overlay {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.5);
                z-index: 1000;
                opacity: 0;
                visibility: hidden;
                transition: var(--transition);
            }
            
            .overlay.active {
                opacity: 1;
                visibility: visible;
            }
        }

        @media (max-width: 576px) {
            .hero h1 {
                font-size: 2.2rem;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .login-container,
            .form-container {
                padding: 2rem 1.5rem;
            }
            
            .achievements-grid {
                grid-template-columns: 1fr;
            }
            
            .gallery-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        /* Animation Classes */
        .fade-in {
            animation: fadeIn 0.6s ease forwards;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .slide-up {
            animation: slideUp 0.6s ease forwards;
        }

        @keyframes slideUp {
            from { 
                opacity: 0;
                transform: translateY(30px);
            }
            to { 
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Utility Classes */
        .text-center {
            text-align: center;
        }

        .mt-1 { margin-top: 0.5rem; }
        .mt-2 { margin-top: 1rem; }
        .mt-3 { margin-top: 1.5rem; }
        .mt-4 { margin-top: 2rem; }
        .mt-5 { margin-top: 3rem; }

        .mb-1 { margin-bottom: 0.5rem; }
        .mb-2 { margin-bottom: 1rem; }
        .mb-3 { margin-bottom: 1.5rem; }
        .mb-4 { margin-bottom: 2rem; }
        .mb-5 { margin-bottom: 3rem; }

        .text-primary { color: var(--primary); }
        .text-light { color: var(--light); }
        .text-muted { color: #aaa; }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #1a1a1a;
        }

        ::-webkit-scrollbar-thumb {
            background: #333;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #444;
        }

        .info-section {
            display: none;
            min-height: 100vh;
            padding: 120px 20px;
            background: #0a0a0a;
        }

        .info-header {
            text-align: center;
            margin-bottom: 2.5rem;
        }

        .info-header h2 {
            font-size: 2.2rem;
            margin-bottom: 0.5rem;
            color: var(--primary);
        }

        .info-header p {
            color: #aaa;
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
            gap: 1.5rem;
        }

        .info-card {
            background: #121212;
            border-radius: 12px;
            padding: 1.5rem;
            border: 1px solid rgba(255, 255, 255, 0.05);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            transition: var(--transition);
        }

        .info-card:hover {
            transform: translateY(-6px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
        }

        .info-card h3 {
            margin-bottom: 0.5rem;
            color: #fff;
        }

        .info-card p {
            color: #aaa;
            font-size: 0.95rem;
        }

        .info-meta {
            margin-top: 1rem;
            font-size: 0.85rem;
            color: #888;
        }

        .info-meta strong {
            color: var(--primary);
            font-weight: 600;
        }

        .info-meta .timing-label,
        .info-meta .centre-label {
            color: var(--primary);
            font-weight: 600;
        }

        .sidebar .menu-item i {
            color: var(--primary);
        }

        .admin-view {
            display: none;
        }

        .admin-view.active {
            display: block;
        }

        .student-view {
            display: none;
        }

        .student-view.active {
            display: block;
        }

        .section-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1.5rem;
        }

        .table {
            width: 100%;
            border-collapse: collapse;
            background: #121212;
            border-radius: 12px;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .table th,
        .table td {
            padding: 0.9rem 1rem;
            font-size: 0.9rem;
            text-align: left;
        }

        .table thead {
            background: #181818;
        }

        .table tbody tr:nth-child(even) {
            background: #101010;
        }

        .badge {
            display: inline-block;
            padding: 0.25rem 0.6rem;
            border-radius: 999px;
            font-size: 0.8rem;
        }

        .badge-paid {
            background: rgba(76, 175, 80, 0.15);
            color: #4caf50;
        }

        .badge-pending {
            background: rgba(255, 193, 7, 0.15);
            color: #ffc107;
        }

        .badge-overdue {
            background: rgba(244, 67, 54, 0.15);
            color: #f44336;
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="container nav-container">
            <a href="#" class="logo" onclick="showSection('home')">
                <img src="image.png" alt="WTSKF-GOA Logo" style="height: 40px; width: 40px; object-fit: cover; border-radius: 50%; border: 2px solid var(--primary); margin-right: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.3);">
                WTSKF-GOA
            </a>
            
            <div class="hamburger" id="hamburger">
                <i class="fas fa-bars"></i>
            </div>
            
            <div class="nav-links" id="navLinks">
                <a href="#" class="active" onclick="showSection('home')">Home</a>
                <a href="#" onclick="showSection('login')">Login</a>
                <a href="#" onclick="showSection('admission')">Admission</a>
                <a href="#" onclick="showSection('courses')">Courses</a>
                <a href="#" onclick="showSection('instructors')">Instructors</a>
                <a href="gallery.html">Achievements</a>
            </div>
            
            <div class="auth-buttons">
                <a href="#" class="btn btn-outline" onclick="showSection('login')">Login</a>
                <a href="#" class="btn btn-primary" onclick="showSection('admission')">Join Now</a>
            </div>
        </div>
    </nav>

    <!-- Overlay for Mobile Menu -->
    <div class="overlay" id="overlay"></div>

    <!-- Home Section -->
    <section class="hero" id="home">
        <video class="hero-video" autoplay muted loop playsinline>
            <source src="vi.mp4" type="video/mp4">
        </video>
        <div class="hero-content">
            <h1>Master the Art of Karate</h1>
            <div class="tagline">
                <span>Discipline</span>
                <span>Strength</span>
                <span>Respect</span>
            </div>
            <p>Join our WTSKF-GOA dojo and embark on a journey of self-discovery, discipline, and mastery. Train with the best instructors and become part of a legacy of excellence.</p>
            <div class="cta-buttons">
                <a href="#" class="btn btn-primary" onclick="showSection('admission')">Join Now</a>
                <a href="gallery.html" class="btn btn-outline">Our Achievements</a>
            </div>
        </div>
    </section>

    <section class="info-section" id="courses">
        <div class="container">
            <div class="info-header">
                <h2>Our Courses</h2>
                <p>Choose the perfect karate program for your age and skill level.</p>
            </div>
            <div class="info-grid" id="courses-list">
                <!-- Course cards will be dynamically inserted here -->
            </div>
        </div>
    </section>

    <section class="info-section" id="instructors">
        <div class="container">
            <div class="info-header">
                <h2>Our Instructors</h2>
                <p>Train under experienced senseis dedicated to your growth.</p>
            </div>
            <div class="info-grid" id="instructors-list">
                <!-- Instructor cards will be dynamically inserted here -->
            </div>
        </div>
    </section>

    <!-- Login Section -->
    <section class="login-section" id="login">
        <div class="login-container">
            <div class="login-header">
                <h2>Welcome Back</h2>
                <p>Login to access your dashboard</p>
            </div>
            <form id="loginForm">
                <div class="form-group">
                    <label for="role">Login As</label>
                    <select id="role" class="form-control" required>
                        <option value="student" selected>Student</option>
                        <option value="admin">Admin</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="email">Email Address</label>
                    <input type="email" id="email" class="form-control" placeholder="Enter your email" required>
                </div>
                <div class="form-group">
                    <label for="password">Password</label>
                    <input type="password" id="password" class="form-control" placeholder="Enter your password" required>
                    <a href="#" class="forgot-password">Forgot Password?</a>
                </div>
                <button type="submit" class="btn-login">Login</button>
                
                <div class="divider">or continue with</div>
                
                <div class="social-login">
                    <button type="button" class="btn-social">
                        <i class="fab fa-google"></i> Continue with Google
                    </button>
                    <button type="button" class="btn-social">
                        <i class="fab fa-facebook-f"></i> Continue with Facebook
                    </button>
                </div>
                
                <p class="register-link">
                    Don't have an account? <a href="#" onclick="showSection('student-registration')">Register here</a>
                </p>
            </form>
        </div>
    </section>
    
    <!-- Student Registration Section -->
    <section class="admission-section" id="student-registration">
        <div class="form-container">
            <div class="form-header">
                <h2>Student Registration</h2>
                <p>Register to access your student dashboard</p>
            </div>
            <form id="studentRegistrationForm">
                <div class="form-row">
                    <div class="form-group half">
                        <label for="studentFirstName">First Name</label>
                        <input type="text" id="studentFirstName" class="form-control" placeholder="Enter your first name" required>
                    </div>
                    <div class="form-group half">
                        <label for="studentLastName">Last Name</label>
                        <input type="text" id="studentLastName" class="form-control" placeholder="Enter your last name" required>
                    </div>
                </div>
                <div class="form-group">
                    <label for="studentEmail">Email Address</label>
                    <input type="email" id="studentEmail" class="form-control" placeholder="Enter your email" required>
                </div>
                <div class="form-group">
                    <label for="studentPhone">Phone Number</label>
                    <input type="tel" id="studentPhone" class="form-control" placeholder="Enter your phone number" required>
                </div>
                <div class="form-group">
                    <label for="studentBatch">Select Batch</label>
                    <select id="studentBatch" class="form-control" required>
                        <option value="">--Select Batch--</option>
                        <option value="batch1">Batch 1 (Password: karate@batch1)</option>
                        <option value="batch2">Batch 2 (Password: karate@batch2)</option>
                        <option value="batch3">Batch 3 (Password: karate@batch3)</option>
                        <option value="batch4">Batch 4 (Password: karate@batch4)</option>
                        <option value="batchA1">Batch A1 (Password: karate@batchA1)</option>
                    </select>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-cancel" onclick="showSection('login')">Cancel</button>
                    <button type="submit" class="btn btn-primary">Register</button>
                </div>
            </form>
        </div>
    </section>
    
    <!-- Admin Login Modal -->
    <div class="modal" id="adminLoginModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Admin Login</h3>
                <span class="close" onclick="closeModal('adminLoginModal')">&times;</span>
            </div>
            <div class="modal-body">
                <form id="adminLoginForm">
                    <div class="form-group">
                        <label for="adminEmail">Email</label>
                        <input type="email" id="adminEmail" class="form-control" placeholder="Enter admin email" required>
                    </div>
                    <div class="form-group">
                        <label for="adminPassword">Password</label>
                        <input type="password" id="adminPassword" class="form-control" placeholder="Enter admin password" required>
                    </div>
                    <button type="submit" class="btn btn-primary">Login</button>
                    <button type="button" class="btn btn-cancel" onclick="closeModal('adminLoginModal')">Cancel</button>
                </form>
            </div>
        </div>
    </div>

    <!-- Admin Dashboard Section -->
    <section class="dashboard" id="admin-dashboard">
        <div class="dashboard-container">
            <!-- Sidebar -->
            <aside class="sidebar" id="adminSidebar">
                <div class="sidebar-header">
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <img src="image.png" alt="WTSKF-GOA Logo" style="height: 32px; width: 32px; object-fit: cover; border-radius: 50%; border: 2px solid var(--primary); box-shadow: 0 2px 6px rgba(0,0,0,0.3);">
                        <h3>Admin Panel</h3>
                    </div>
                </div>
                
                <div class="sidebar-menu">
                    <p class="menu-title">Main</p>
                    <a href="#" class="menu-item active" onclick="showAdminView('admin-home', this)">
                        <i class="fas fa-tachometer-alt"></i> Dashboard
                    </a>
                    <a href="#" class="menu-item" onclick="showAdminView('admin-instructors', this)">
                        <i class="fas fa-user-shield"></i> Instructors
                    </a>
                    <a href="#" class="menu-item" onclick="showAdminView('admin-batches', this)">
                        <i class="fas fa-layer-group"></i> Batches
                    </a>
                    <a href="#" class="menu-item" onclick="showAdminView('admin-admissions', this)">
                        <i class="fas fa-user-plus"></i> New Admissions
                    </a>
                                        <a href="#" class="menu-item" onclick="showAdminView('admin-fees-payments', this)">
                        <i class="fas fa-money-check-alt"></i> Fees Payment
                    </a>
                    <a href="#" class="menu-item" onclick="showAdminView('admin-tournaments', this)">
                        <i class="fas fa-trophy"></i> Tournaments
                    </a>
                    <a href="#" class="menu-item" onclick="showAdminView('admin-store', this)">
                        <i class="fas fa-store"></i> Store Items
                    </a>
                    <a href="#" class="menu-item" onclick="showAdminView('admin-exams', this)">
                        <i class="fas fa-file-alt"></i> Exams
                    </a>
                    <a href="#" class="menu-item" onclick="showAdminView('admin-announcements', this)">
                        <i class="fas fa-bullhorn"></i> Announcements
                    </a>
                                        
                    <p class="menu-title">Registrations</p>
                    <a href="#" class="menu-item" onclick="showAdminView('admin-tournament-registrations', this)">
                        <i class="fas fa-trophy"></i> Tournament Registrations
                    </a>
                    <a href="#" class="menu-item" onclick="showAdminView('admin-exam-registrations', this)">
                        <i class="fas fa-file-alt"></i> Exam Registrations
                    </a>
                    <a href="#" class="menu-item" onclick="showAdminView('admin-store-orders', this)">
                        <i class="fas fa-shopping-cart"></i> Store Orders
                    </a>
                    
                    <p class="menu-title">Account</p>
                    <a href="#" class="menu-item" onclick="showSection('home')">
                        <i class="fas fa-sign-out-alt"></i> Logout
                    </a>
                </div>
            </aside>

            <!-- Main Content -->
            <main class="main-content">
                <div class="dashboard-header">
                    <h1>Admin Dashboard</h1>
                    <div class="user-profile">
                        <div class="user-avatar">AD</div>
                        <span class="user-name">Admin</span>
                    </div>
                </div>

                <div class="admin-view active" id="admin-home">
                    <!-- Stats Cards -->
                    <div class="stats-grid">

                        <div class="stat-card stat-3">
                            <div class="stat-header">
                                <div>
                                    <div class="stat-value" id="admin-new-admissions">0</div>
                                    <div class="stat-title">New Admissions</div>
                                </div>
                                <div class="stat-icon">
                                    <i class="fas fa-user-plus"></i>
                                </div>
                            </div>
                            <div class="stat-change positive">
                                <i class="fas fa-arrow-up"></i> This month
                            </div>
                        </div>

                        <div class="stat-card stat-4">
                            <div class="stat-header">
                                <div>
                                    <div class="stat-value" id="admin-tournaments-registered">0</div>
                                    <div class="stat-title">Tournaments Registered</div>
                                </div>
                                <div class="stat-icon">
                                    <i class="fas fa-trophy"></i>
                                </div>
                            </div>
                            <div class="stat-change positive">
                                <i class="fas fa-arrow-up"></i> Active
                            </div>
                        </div>

                        <div class="stat-card stat-3">
                            <div class="stat-header">
                                <div>
                                    <div class="stat-value" id="admin-upcoming-exams">0</div>
                                    <div class="stat-title">Upcoming Exams</div>
                                </div>
                                <div class="stat-icon">
                                    <i class="fas fa-file-alt"></i>
                                </div>
                            </div>
                            <div class="stat-change positive">
                                <i class="fas fa-arrow-up"></i> Updated
                            </div>
                        </div>

                                            </div>

                    <!-- Recent Activity -->
                    <div class="recent-activity">
                        <h3 class="section-title">
                            <i class="fas fa-history"></i> Recent Activity
                        </h3>
                        <ul class="activity-list" id="admin-recent-activity">
                            <!-- Recent activity will be dynamically inserted here -->
                        </ul>
                    </div>
                </div>

                <div class="admin-view" id="admin-instructors">
                    <div class="section-header">
                        <h2 class="section-title"><i class="fas fa-user-shield"></i> Instructors</h2>
                        <button type="button" class="btn btn-primary" onclick="openInstructorForm()">Add Instructor</button>
                    </div>
                    <table class="table" id="admin-instructors-table">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Description</th>
                                <th>Rank</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>

                <div class="admin-view" id="admin-batches">
                    <div class="section-header">
                        <h2 class="section-title"><i class="fas fa-layer-group"></i> Batches</h2>
                        <button type="button" class="btn btn-primary" onclick="openBatchForm()">Add Batch</button>
                    </div>
                    <div id="admin-batches-list"></div>
                </div>

                <div class="admin-view" id="admin-admissions">
                    <div class="section-header">
                        <h2 class="section-title"><i class="fas fa-user-plus"></i> New Admissions</h2>
                    </div>
                    <div id="admin-admissions-empty" class="text-muted mb-2">No admissions yet. New admission form submissions will appear here automatically.</div>
                    <table class="table" id="admin-admissions-table">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Age</th>
                                <th>Belt Level</th>
                                <th>Contact</th>
                                <th>Address</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>

                
                <div class="admin-view" id="admin-fees-payments">
                    <div class="section-header" style="display:flex; align-items:center; gap:12px; flex-wrap:wrap;">
                        <h2 class="section-title" style="margin-right:auto"><i class="fas fa-money-check-alt"></i> Fees Payment</h2>
                        <input type="text" id="feesSearch" class="form-control" placeholder="Search name/phone/handle..." style="max-width:260px;">
                        <select id="feesFilterCentre" class="form-control" style="max-width:160px;">
                            <option value="">All Centres</option>
                        </select>
                        <select id="feesFilterBatch" class="form-control" style="max-width:200px;">
                            <option value="">All Batches</option>
                        </select>
                        <button type="button" class="btn btn-primary" onclick="downloadFeesCsv()"><i class="fas fa-file-csv"></i> Download CSV</button>
                    </div>
                    <table class="table" id="admin-fees-table">
                        <thead>
                            <tr>
                                <th data-sort="full_name">Student Full Name</th>
                                <th data-sort="phone">Phone Number</th>
                                <th data-sort="batch_name">Batch Name</th>
                                <th data-sort="centre">Centre</th>
                                <th data-sort="payment_datetime">Date & Time</th>
                                <th data-sort="status">Payment Status</th>
                            </tr>
                        </thead>
                        <tbody id="admin-fees-tbody"></tbody>
                    </table>
                </div>

                <div class="admin-view" id="admin-tournaments">
                    <div class="section-header">
                        <h2 class="section-title"><i class="fas fa-trophy"></i> Tournaments</h2>
                        <button type="button" class="btn btn-primary" onclick="openTournamentForm()">Add Tournament</button>
                    </div>
                    <div class="info-grid" id="admin-tournaments-list"></div>
                </div>

                <div class="admin-view" id="admin-store">
                    <div class="section-header">
                        <h2 class="section-title"><i class="fas fa-store"></i> Store Items</h2>
                        <button type="button" class="btn btn-primary" onclick="openStoreItemForm()">Add Store Product</button>
                    </div>
                    <div class="info-grid" id="admin-store-list"></div>
                </div>

                <div class="admin-view" id="admin-exams">
                    <div class="section-header">
                        <h2 class="section-title"><i class="fas fa-file-alt"></i> Exams</h2>
                        <button type="button" class="btn btn-primary" onclick="openExamForm()">Add New Exam</button>
                    </div>
                    <div class="info-grid" id="admin-exams-list"></div>
                </div>

                <div class="admin-view" id="admin-announcements">
                    <div class="section-header">
                        <h2 class="section-title"><i class="fas fa-bullhorn"></i> Announcements</h2>
                    </div>
                    <div class="form-group">
                        <label for="announcementText">Post Announcement</label>
                        <textarea id="announcementText" class="form-control" rows="3" placeholder="Write your announcement for students..."></textarea>
                    </div>
                    <button type="button" class="btn btn-primary mt-2" onclick="postAnnouncement()">Post Announcement</button>
                    <div class="recent-activity mt-4">
                        <h3 class="section-title">
                            <i class="fas fa-bell"></i> All Announcements
                        </h3>
                        <ul class="activity-list" id="admin-announcements-list"></ul>
                    </div>
                </div>

                
                <div class="admin-view" id="admin-tournament-registrations">
                    <div class="section-header">
                        <h2 class="section-title"><i class="fas fa-trophy"></i> Tournament Registrations</h2>
                    </div>
                    <table class="table" id="admin-tournament-registrations-table">
                        <thead>
                            <tr>
                                <th>Tournament</th>
                                <th>Name</th>
                                <th>Email</th>
                                <th>Phone</th>
                                <th>Centre</th>
                                <th>Batch</th>
                                <th>Date</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>

                <div class="admin-view" id="admin-exam-registrations">
                    <div class="section-header">
                        <h2 class="section-title"><i class="fas fa-file-alt"></i> Exam Registrations</h2>
                    </div>
                    <table class="table" id="admin-exam-registrations-table">
                        <thead>
                            <tr>
                                <th>Exam</th>
                                <th>Name</th>
                                <th>Email</th>
                                <th>Phone</th>
                                <th>Centre</th>
                                <th>Batch</th>
                                <th>Date</th>
                                <th>Belt</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>

                <div class="admin-view" id="admin-store-orders">
                    <div class="section-header">
                        <h2 class="section-title"><i class="fas fa-shopping-cart"></i> Store Orders</h2>
                    </div>
                    <table class="table" id="admin-store-orders-table">
                        <thead>
                            <tr>
                                <th>Item</th>
                                <th>Name</th>
                                <th>Email</th>
                                <th>Phone</th>
                                <th>Centre</th>
                                <th>Batch</th>
                                <th>Quantity</th>
                                <th>Total Price</th>
                                <th>Status</th>
                                <th>Date</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </main>
        </div>
    </section>

    <section class="dashboard" id="student-dashboard">
        <div class="dashboard-container">
            <aside class="sidebar" id="studentSidebar">
                <div class="sidebar-header">
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <img src="image.png" alt="WTSKF-GOA Logo" style="height: 32px; width: 32px; object-fit: cover; border-radius: 50%; border: 2px solid var(--primary); box-shadow: 0 2px 6px rgba(0,0,0,0.3);">
                        <h3>Student</h3>
                    </div>
                </div>
                <div class="sidebar-menu">
                    <p class="menu-title">Menu</p>
                    <a href="#" class="menu-item active" onclick="showStudentView('student-home', this)">
                        <i class="fas fa-home"></i> Dashboard
                    </a>
                    <a href="#" class="menu-item" onclick="showStudentView('student-tournaments', this)">
                        <i class="fas fa-trophy"></i> Tournaments
                    </a>
                    <a href="#" class="menu-item" onclick="showStudentView('student-store', this)">
                        <i class="fas fa-store"></i> Store
                    </a>
                    <a href="#" class="menu-item" onclick="showStudentView('student-exams', this)">
                        <i class="fas fa-file-alt"></i> Exams
                    </a>
                    <a href="#" class="menu-item" onclick="showStudentView('student-announcements', this)">
                        <i class="fas fa-bullhorn"></i> Announcements
                    </a>
                    <a href="#" class="menu-item" onclick="showStudentView('student-payment', this)">
                        <i class="fas fa-credit-card"></i> Fee Payment
                    </a>
                    <a href="#" class="menu-item" onclick="showSection('home')">
                        <i class="fas fa-sign-out-alt"></i> Logout
                    </a>
                </div>
            </aside>

            <main class="main-content">
                <div class="dashboard-header">
                    <h1>Student Dashboard</h1>
                    <div class="user-profile">
                        <div class="user-avatar">ST</div>
                        <span class="user-name">Student</span>
                    </div>
                </div>

                <div class="student-view active" id="student-home">
                    <div class="stats-grid">
                        <div class="stat-card stat-1">
                            <div class="stat-header">
                                <div>
                                    <div class="stat-value" id="student-registered-tournaments">0</div>
                                    <div class="stat-title">Registered Tournaments</div>
                                </div>
                                <div class="stat-icon">
                                    <i class="fas fa-trophy"></i>
                                </div>
                            </div>
                        </div>
                        <div class="stat-card stat-2">
                            <div class="stat-header">
                                <div>
                                    <div class="stat-value" id="student-upcoming-exams">0</div>
                                    <div class="stat-title">Upcoming Exams</div>
                                </div>
                                <div class="stat-icon">
                                    <i class="fas fa-file-alt"></i>
                                </div>
                            </div>
                        </div>
                        <div class="stat-card stat-3">
                            <div class="stat-header">
                                <div>
                                    <div class="stat-value" id="student-new-announcements">0</div>
                                    <div class="stat-title">New Announcements</div>
                                </div>
                                <div class="stat-icon">
                                    <i class="fas fa-bell"></i>
                                </div>
                            </div>
                        </div>
                        <div class="stat-card stat-4">
                            <div class="stat-header">
                                <div>
                                    <div class="stat-value" id="student-store-items">0</div>
                                    <div class="stat-title">Store Items</div>
                                </div>
                                <div class="stat-icon">
                                    <i class="fas fa-store"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="student-view" id="student-tournaments">
                    <div class="section-header">
                        <h2 class="section-title"><i class="fas fa-trophy"></i> Tournaments</h2>
                    </div>
                    <div class="info-grid" id="student-tournaments-list"></div>
                </div>

                <div class="student-view" id="student-store">
                    <div class="section-header">
                        <h2 class="section-title"><i class="fas fa-store"></i> Store Items</h2>
                    </div>
                    <div class="info-grid" id="student-store-list"></div>
                </div>

                <div class="student-view" id="student-exams">
                    <div class="section-header">
                        <h2 class="section-title"><i class="fas fa-file-alt"></i> Exams</h2>
                    </div>
                    <div class="info-grid" id="student-exams-list"></div>
                </div>

                <div class="student-view" id="student-announcements">
                    <div class="section-header">
                        <h2 class="section-title"><i class="fas fa-bullhorn"></i> Announcements</h2>
                    </div>
                    <div class="recent-activity">
                        <h3 class="section-title">
                            <i class="fas fa-bell"></i> Latest Announcements
                        </h3>
                        <ul class="activity-list" id="student-announcements-list"></ul>
                    </div>
                </div>

                <div class="student-view" id="student-payment">
                    <div class="section-header">
                        <h2 class="section-title"><i class="fas fa-credit-card"></i> Fee Payment</h2>
                    </div>
                    <iframe src="payment.html" style="width: 100%; height: 1200px; border: none; border-radius: 12px; background: transparent;"></iframe>
                </div>
            </main>
        </div>
    </section>

    <!-- Admission Form Section -->
    <section class="admission-section" id="admission">
        <div class="form-container">
            <div class="form-header">
                <h2>Join WTSKF-GOA</h2>
                <p>Fill out the form below to start your karate journey with us</p>
            </div>
            
            <form id="admissionForm">
                <div class="form-row">
                    <div class="form-group half">
                        <label for="firstName">First Name *</label>
                        <input type="text" id="firstName" class="form-control" placeholder="Enter your first name" required>
                    </div>
                    <div class="form-group half">
                        <label for="lastName">Last Name *</label>
                        <input type="text" id="lastName" class="form-control" placeholder="Enter your last name" required>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group half">
                        <label for="emailAdmission">Email Address *</label>
                        <input type="email" id="emailAdmission" class="form-control" placeholder="Enter your email address" required>
                    </div>
                    <div class="form-group half">
                        <label for="phone">Phone Number *</label>
                        <input type="tel" id="phone" class="form-control" placeholder="Enter your phone number" required>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group half">
                        <label for="age">Age *</label>
                        <input type="number" id="age" class="form-control" min="5" max="80" placeholder="Enter your age" required>
                    </div>
                    <div class="form-group half">
                        <label for="beltLevel">Belt Level *</label>
                        <select id="beltLevel" class="form-control" required>
                            <option value="" disabled selected>Select your belt level</option>
                            <option value="white">White Belt (Beginner)</option>
                            <option value="yellow">Yellow Belt</option>
                            <option value="orange">Orange Belt</option>
                            <option value="green">Green Belt</option>
                            <option value="blue">Blue Belt</option>
                            <option value="purple">Purple Belt</option>
                            <option value="brown">Brown Belt</option>
                            <option value="black">Black Belt</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="address">Address *</label>
                    <input type="text" id="address" class="form-control" placeholder="Enter your full address" required>
                </div>
                
                <div class="form-group">
                    <label for="centre">Centre *</label>
                    <select id="centre" class="form-control" required>
                        <option value="" disabled selected>Select your centre</option>
                        <option value="st.cruz">St. Cruz</option>
                        <option value="girim">Girim</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="photo">Photo (Optional)</label>
                    <div class="file-upload">
                        <label for="photo" class="file-upload-label">
                            <div class="file-upload-icon">
                                <i class="fas fa-camera"></i>
                            </div>
                            <div class="file-upload-text">Click to upload photo</div>
                            <div class="file-upload-hint">JPG, PNG or GIF (MAX. 2MB)</div>
                        </label>
                        <input type="file" id="photo" class="file-upload-input" accept="image/*">
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Preferred Batch Timing *</label>
                    <select id="batchTiming" class="form-control" required>
                        <option value="" disabled selected>Select your preferred batch</option>
                        <option value="batch1">Batch 1: Tue, Thu, Sat (4:30 PM - 6:00 PM, ST.CRUZ)</option>
                        <option value="batch2">Batch 2: Tue, Thu, Sat (6:00 PM - 8:00 PM, ST.CRUZ)</option>
                        <option value="batch3">Batch 3: Mon, Wed, Fri (4:30 PM - 6:00 PM, ST.CRUZ)</option>
                        <option value="batch4">Batch 4: Mon, Wed, Fri (6:00 PM - 8:00 PM, ST.CRUZ)</option>
                        <option value="batchA1">Batch A1: Mon, Wed, Fri (6:00 PM - 8:00 PM, GUIRIM)</option>
                    </select>
                </div>
                
                <button type="submit" class="btn btn-primary">Register Now</button>
                <button type="button" class="btn btn-cancel" onclick="showSection('home')">Cancel</button>
            </form>
        </div>
    </section>

    <!-- Achievements Section -->
    <section class="achievements-section" id="achievements">
        <div class="container achievements-inner">
            <div class="achievements-header">
                <span class="section-subtitle">Our Success Stories</span>
                <h2 class="section-title-large">Student Achievements</h2>
                <p class="section-description">
                    Celebrating the remarkable accomplishments of our students in national and international karate championships. 
                    Their dedication and hard work continue to inspire us all.
                </p>
            </div>
            
            <div class="achievements-grid">
                <div class="achievement-card">
                    <div class="achievement-image">
                        <img src="https://images.unsplash.com/photo-1560272564-c83b9c9c3586?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1470&q=80" alt="Karate Champion">
                    </div>
                    <div class="achievement-content">
                        <span class="achievement-date">June 15, 2023</span>
                        <h3 class="achievement-title">National Karate Championship Gold</h3>
                        <p class="achievement-desc">
                            John Martinez secured the gold medal in the National Karate Championship, showcasing exceptional skill and discipline in the finals.
                        </p>
                        <div class="achievement-meta">
                            <span class="achievement-student">
                                <span class="student-avatar">JM</span>
                                John Martinez
                            </span>
                            <span class="achievement-category">Kumite -75kg</span>
                        </div>
                    </div>
                </div>
                
                <div class="achievement-card">
                    <div class="achievement-image">
                        <img src="https://images.unsplash.com/photo-1600267165477-824166c5a9a1?ixlib=rb-4.0.3&ixlib=rb-4.0.3&auto=format&fit=crop&w=1470&q=80" alt="Karate Champion">
                    </div>
                    <div class="achievement-content">
                        <span class="achievement-date">May 22, 2023</span>
                        <h3 class="achievement-title">International Open Silver Medal</h3>
                        <p class="achievement-desc">
                            Sarah Chen won the silver medal at the International Karate Open, demonstrating remarkable technique and sportsmanship.
                        </p>
                        <div class="achievement-meta">
                            <span class="achievement-student">
                                <span class="student-avatar">SC</span>
                                Sarah Chen
                            </span>
                            <span class="achievement-category">Kata Individual</span>
                        </div>
                    </div>
                </div>
                
                <div class="achievement-card">
                    <div class="achievement-image">
                        <img src="https://images.unsplash.com/photo-1601584115197-04ecc0da31d8?ixlib=rb-4.0.3&ixlib=rb-4.0.3&auto=format&fit=crop&w=1470&q=80" alt="Karate Champion">
                    </div>
                    <div class="achievement-content">
                        <span class="achievement-date">April 5, 2023</span>
                        <h3 class="achievement-title">State Championship Gold</h3>
                        <p class="achievement-desc">
                            Michael Johnson dominated the State Karate Championship, winning gold in both Kata and Kumite categories.
                        </p>
                        <div class="achievement-meta">
                            <span class="achievement-student">
                                <span class="student-avatar">MJ</span>
                                Michael Johnson
                            </span>
                            <span class="achievement-category">Kata & Kumite</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="gallery-section">
                <h3 class="section-title">
                    <i class="fas fa-images"></i> Tournament Gallery
                </h3>
                
                <div class="gallery-grid">
                    <div class="gallery-item">
                        <img src="https://images.unsplash.com/photo-1554020160-0d9c328a1d3c?ixlib=rb-4.0.3&ixlib=rb-4.0.3&auto=format&fit=crop&w=1470&q=80" alt="Karate Tournament">
                        <div class="gallery-overlay">
                            <h4 class="gallery-title">National Championship 2023</h4>
                            <span class="gallery-category">Kumite Finals</span>
                        </div>
                    </div>
                    
                    <div class="gallery-item">
                        <img src="https://images.unsplash.com/photo-1600267165497-1a9b2b0d4f55?ixlib=rb-4.0.3&ixlib=rb-4.0.3&auto=format&fit=crop&w=1470&q=80" alt="Karate Training">
                        <div class="gallery-overlay">
                            <h4 class="gallery-title">Intensive Training Camp</h4>
                            <span class="gallery-category">Summer 2023</span>
                        </div>
                    </div>
                    
                    <div class="gallery-item">
                        <img src="https://images.unsplash.com/photo-1600267165520-1d3d6d8f4c5a?ixlib=rb-4.0.3&ixlib=rb-4.0.3&auto=format&fit=crop&w=1470&q=80" alt="Karate Belt Ceremony">
                        <div class="gallery-overlay">
                            <h4 class="gallery-title">Belt Promotion</h4>
                            <span class="gallery-category">Spring 2023</span>
                        </div>
                    </div>
                    
                    <div class="gallery-item">
                        <img src="https://images.unsplash.com/photo-1600267165477-824166c5a9a1?ixlib=rb-4.0.3&ixlib=rb-4.0.3&auto=format&fit=crop&w=1470&q=80" alt="Karate Kata">
                        <div class="gallery-overlay">
                            <h4 class="gallery-title">International Open</h4>
                            <span class="gallery-category">Kata Finals</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Gallery CTA -->
            <div style="text-align: center; margin-top: 3rem;">
                <a href="gallery.html" class="btn btn-primary" style="font-size: 1.1rem; padding: 1rem 2.5rem; border-radius: 30px; display: inline-flex; align-items: center; gap: 0.8rem;">
                    <i class="fas fa-images"></i>
                    View Full Gallery
                </a>
            </div>
        </div>
    </section>

    <!-- Success Modal -->
    <div class="modal" id="successModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Application Submitted!</h3>
                <button class="close-modal" onclick="closeModal('successModal')">&times;</button>
            </div>
            <div class="modal-body">
                <p class="modal-message">
                    Thank you for registering with WTSKF-GOA! We've sent a verification email to your email address. 
                    Please check your inbox and click the verification link to complete your registration.
                </p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-cancel" onclick="closeModal('successModal')">Close</button>
                <button class="btn btn-primary" onclick="closeModal('successModal'); showSection('home');">Back to Home</button>
            </div>
        </div>
    </div>

    <!-- Tournament Registration Modal -->
    <div class="modal" id="tournamentRegistrationModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Tournament Registration</h3>
                <button class="close-modal" onclick="closeModal('tournamentRegistrationModal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="tournamentRegistrationForm">
                    <input type="hidden" id="tournamentId">
                    
                    <!-- Tournament Info Section -->
                    <div class="form-section">
                        <div class="form-group">
                            <label>Tournament</label>
                            <input type="text" id="tournamentTitle" readonly class="form-control">
                        </div>
                    </div>
                    
                    <!-- Personal Information Section -->
                    <div class="form-section">
                        <h4 class="section-subtitle">Personal Information</h4>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Full Name *</label>
                                <input type="text" name="name" class="form-control" placeholder="Enter your full name" required>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label>Email Address *</label>
                                <input type="email" name="email" class="form-control" placeholder="your.email@example.com" required>
                            </div>
                            <div class="form-group">
                                <label>Phone Number *</label>
                                <input type="tel" name="phone" class="form-control" placeholder="+91 98765 43210" required>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Training Information Section -->
                    <div class="form-section">
                        <h4 class="section-subtitle">Training Information</h4>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Training Centre *</label>
                                <input type="text" name="centre" class="form-control" placeholder="Main Branch" required>
                            </div>
                            <div class="form-group">
                                <label>Batch Timing *</label>
                                <input type="text" name="batch" class="form-control" placeholder="Morning 6-7 AM" required>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-cancel" onclick="closeModal('tournamentRegistrationModal')">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="submitTournamentRegistration()">Register Now</button>
            </div>
        </div>
    </div>

    <!-- Exam Registration Modal -->
    <div class="modal" id="examRegistrationModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Exam Registration</h3>
                <button class="close-modal" onclick="closeModal('examRegistrationModal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="examRegistrationForm">
                    <input type="hidden" id="examId">
                    
                    <!-- Exam Info Section -->
                    <div class="form-section">
                        <div class="form-group">
                            <label>Exam</label>
                            <input type="text" id="examTitle" readonly class="form-control">
                        </div>
                    </div>
                    
                    <!-- Personal Information Section -->
                    <div class="form-section">
                        <h4 class="section-subtitle">Personal Information</h4>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Full Name *</label>
                                <input type="text" name="name" class="form-control" placeholder="Enter your full name" required>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label>Email Address *</label>
                                <input type="email" name="email" class="form-control" placeholder="your.email@example.com" required>
                            </div>
                            <div class="form-group">
                                <label>Phone Number *</label>
                                <input type="tel" name="phone" class="form-control" placeholder="+91 98765 43210" required>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Training Information Section -->
                    <div class="form-section">
                        <h4 class="section-subtitle">Training Information</h4>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Training Centre *</label>
                                <input type="text" name="centre" class="form-control" placeholder="Main Branch" required>
                            </div>
                            <div class="form-group">
                                <label>Batch Timing *</label>
                                <input type="text" name="batch" class="form-control" placeholder="Morning 6-7 AM" required>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-cancel" onclick="closeModal('examRegistrationModal')">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="submitExamRegistration()">Register Now</button>
            </div>
        </div>
    </div>

    <!-- Store Order Modal -->
    <div class="modal" id="storeOrderModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Store Order</h3>
                <button class="close-modal" onclick="closeModal('storeOrderModal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="storeOrderForm">
                    <input type="hidden" id="storeItemId">
                    
                    <!-- Item Info Section -->
                    <div class="form-section">
                        <h4 class="section-subtitle">Item Details</h4>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Item</label>
                                <input type="text" id="itemName" readonly class="form-control">
                            </div>
                            <div class="form-group">
                                <label>Price</label>
                                <input type="text" id="itemPrice" readonly class="form-control">
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Quantity *</label>
                            <input type="number" name="quantity" class="form-control" value="1" min="1" max="10" required>
                        </div>
                    </div>
                    
                    <!-- Personal Information Section -->
                    <div class="form-section">
                        <h4 class="section-subtitle">Personal Information</h4>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Full Name *</label>
                                <input type="text" name="name" class="form-control" placeholder="Enter your full name" required>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label>Email Address *</label>
                                <input type="email" name="email" class="form-control" placeholder="your.email@example.com" required>
                            </div>
                            <div class="form-group">
                                <label>Phone Number *</label>
                                <input type="tel" name="phone" class="form-control" placeholder="+91 98765 43210" required>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Training Information Section -->
                    <div class="form-section">
                        <h4 class="section-subtitle">Training Information</h4>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Training Centre *</label>
                                <input type="text" name="centre" class="form-control" placeholder="Main Branch" required>
                            </div>
                            <div class="form-group">
                                <label>Batch Timing *</label>
                                <input type="text" name="batch" class="form-control" placeholder="Morning 6-7 AM" required>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-cancel" onclick="closeModal('storeOrderModal')">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="submitStoreOrder()">Place Order</button>
            </div>
        </div>
    </div>

    <!-- Instructor Management Modal -->
    <div class="modal" id="instructorModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="instructorModalTitle">Add Instructor</h3>
                <button class="close-modal" onclick="closeInstructorModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="instructorForm">
                    <input type="hidden" id="instructorId">
                    <div class="form-group">
                        <label>Instructor Name *</label>
                        <input type="text" id="instructorName" class="form-control" placeholder="Enter instructor name" required>
                    </div>
                    <div class="form-group">
                        <label>Description</label>
                        <textarea id="instructorDescription" class="form-control" placeholder="Enter instructor description" rows="3"></textarea>
                    </div>
                    <div class="form-group">
                        <label>Rank</label>
                        <input type="text" id="instructorRank" class="form-control" placeholder="Enter instructor rank">
                    </div>
                    <div class="form-group">
                        <label>Photo</label>
                        <input type="file" id="instructorPhoto" class="form-control" accept="image/*" onchange="previewInstructorPhoto(this)" style="padding: 8px; border: 1px solid #333; background: #1a1a1a; border-radius: 4px;">
                        <div id="photoPreview" style="margin-top: 10px; max-width: 200px; max-height: 200px; display: none;"></div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-cancel" onclick="closeInstructorModal()">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="saveInstructor()">Save</button>
            </div>
        </div>
    </div>

    <!-- Batch Management Modal -->
    <div class="modal" id="batchModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="batchModalTitle">Add Batch</h3>
                <button class="close-modal" onclick="closeBatchModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="batchForm">
                    <input type="hidden" id="batchId">
                    <div class="form-group">
                        <label>Batch Name *</label>
                        <input type="text" id="batchModalName" class="form-control" placeholder="Enter batch name" required>
                    </div>
                    <div class="form-group">
                        <label>Description</label>
                        <textarea id="batchModalDescription" class="form-control" placeholder="Enter batch description" rows="3"></textarea>
                    </div>
                    <div class="form-group">
                        <label>Timing *</label>
                        <input type="text" id="batchModalTiming" class="form-control" placeholder="e.g., 4:30 PM - 5:30 PM" required>
                    </div>
                    <div class="form-group">
                        <label>Centre *</label>
                        <input type="text" id="batchModalCentre" class="form-control" placeholder="e.g., Panjim, Margao, Vasco" required>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-cancel" onclick="closeBatchModal()">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="saveBatch()">Save</button>
            </div>
        </div>
    </div>

    <script>
        (function () {
            // Helper function for authenticated API calls
            async function authenticatedFetch(url, options = {}) {
                const token = localStorage.getItem('authToken');
                if (!token) {
                    throw new Error('No authentication token found');
                }
                
                const headers = {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${token}`,
                    ...options.headers
                };

                return fetch(url, { ...options, headers });
            }

            // Fees Payments (Admin)
            var feesPaymentsState = { rows: [], sortKey: 'payment_datetime', sortDir: 'desc', q: '', centre: '', batch: '' };

            function compare(a, b, key) {
                var va = a[key] || ''; var vb = b[key] || '';
                if (key === 'payment_datetime') return new Date(va) - new Date(vb);
                return String(va).localeCompare(String(vb));
            }

            function renderAdminFeesPayments() {
                var tbody = document.getElementById('admin-fees-tbody');
                if (!tbody) return;

                var rows = feesPaymentsState.rows.slice();
                var q = (feesPaymentsState.q || '').toLowerCase();
                if (q) {
                    rows = rows.filter(function(r){
                        return String(r.full_name||'').toLowerCase().includes(q) || String(r.phone||'').toLowerCase().includes(q) || String(r.txn_id||'').toLowerCase().includes(q);
                    });
                }
                if (feesPaymentsState.centre) rows = rows.filter(function(r){ return r.centre === feesPaymentsState.centre; });
                if (feesPaymentsState.batch) rows = rows.filter(function(r){ return r.batch_name === feesPaymentsState.batch; });
                rows.sort(function(a,b){ return _feesCompare(a,b,feesPaymentsState.sortKey); });
                if (feesPaymentsState.sortDir === 'desc') rows.reverse();

                function getBatchLabel(batchName) {
                    var key = String(batchName || '')
                        .trim()
                        .toLowerCase()
                        .replace(/[^a-z0-9]/g, '');
                    var map = {
                        'batch1': 'Batch 1',
                        'batch2': 'Batch 2',
                        'batch3': 'Batch 3',
                        'batch4': 'Batch 4',
                        'batcha1': 'Batch A1',
                        'stcruz1': 'Batch 1',
                        'stcruz2': 'Batch 2',
                        'stcruz3': 'Batch 3',
                        'stcruz4': 'Batch 4',
                        'guirima1': 'Batch A1'
                    };
                    return map[key] || (batchName || '');
                }

                function formatFeesDateTime(v) {
                    if (!v) return '';
                    var dt = (v instanceof Date) ? v : new Date(v);
                    if (isNaN(dt.getTime()) && typeof v === 'string') {
                        var s = v.trim();
                        if (/^\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}/.test(s)) {
                            dt = new Date(s.replace(' ', 'T') + 'Z');
                        }
                    }
                    if (isNaN(dt.getTime())) return String(v);
                    return dt.toLocaleString('en-IN', {
                        timeZone: 'Asia/Kolkata',
                        year: 'numeric',
                        month: '2-digit',
                        day: '2-digit',
                        hour: '2-digit',
                        minute: '2-digit',
                        second: '2-digit'
                    });
                }

                tbody.innerHTML = rows.map(function(r){
                    var dtStr = formatFeesDateTime(r.payment_datetime);
                    var status = r.status || 'Pending Verification';
                    return '<tr>'+
                        '<td>'+(r.full_name||'')+'</td>'+
                        '<td>'+(r.phone||'')+'</td>'+
                        '<td>'+getBatchLabel(r.batch_name)+'</td>'+
                        '<td>'+(r.centre||'')+'</td>'+
                        '<td>'+dtStr+'</td>'+
                        '<td>'+status+'</td>'+
                    '</tr>';
                }).join('');

                var centreSel = document.getElementById('feesFilterCentre');
                var batchSel = document.getElementById('feesFilterBatch');
                if (centreSel && batchSel && centreSel.options.length <= 1) {
                    var centres = Array.from(new Set(feesPaymentsState.rows.map(function(r){ return r.centre; }).filter(Boolean)));
                    centres.forEach(function(c){ var o=document.createElement('option'); o.value=c; o.textContent=c; centreSel.appendChild(o); });
                    var batches = Array.from(new Set(feesPaymentsState.rows.map(function(r){ return r.batch_name; }).filter(Boolean)));
                    batches.forEach(function(b){ var o=document.createElement('option'); o.value=b; o.textContent=getBatchLabel(b); batchSel.appendChild(o); });
                }
            }

            function attachAdminFeesEvents() {
                var search = document.getElementById('feesSearch');
                var centreSel = document.getElementById('feesFilterCentre');
                var batchSel = document.getElementById('feesFilterBatch');
                var table = document.getElementById('admin-fees-table');
                if (search) search.addEventListener('input', function(){ feesPaymentsState.q = this.value; renderAdminFeesPayments(); });
                if (centreSel) centreSel.addEventListener('change', function(){ feesPaymentsState.centre = this.value; renderAdminFeesPayments(); });
                if (batchSel) batchSel.addEventListener('change', function(){ feesPaymentsState.batch = this.value; renderAdminFeesPayments(); });
                if (table) table.querySelectorAll('th[data-sort]').forEach(function(th){
                    th.style.cursor = 'pointer';
                    th.addEventListener('click', function(){
                        var key = this.getAttribute('data-sort');
                        if (feesPaymentsState.sortKey === key) {
                            feesPaymentsState.sortDir = feesPaymentsState.sortDir === 'asc' ? 'desc' : 'asc';
                        } else {
                            feesPaymentsState.sortKey = key; feesPaymentsState.sortDir = 'asc';
                        }
                        renderAdminFeesPayments();
                    });
                });
            }

            function loadAdminFeesPayments() {
                apiCall('GET', '/api/fees-payments').then(function(rows){
                    feesPaymentsState.rows = rows || [];
                    attachAdminFeesEvents();
                    renderAdminFeesPayments();
                }).catch(console.error);
            }

            // Check if user is authenticated
            function isAuthenticated() {
                const token = localStorage.getItem('authToken');
                const user = sessionStorage.getItem('currentUser');
                return token && user;
            }

            // Logout function
            function logout() {
                localStorage.removeItem('authToken');
                sessionStorage.removeItem('currentUser');
                showSection('login');
            }

            // Cache top-level sections and remember their original display values
            var sectionIds = ['home', 'courses', 'instructors', 'login', 'admin-dashboard', 'student-dashboard', 'admission', 'student-registration'];
            var sections = [];

            sectionIds.forEach(function (id) {
                var el = document.getElementById(id);
                if (!el) return;
                var display = (window.getComputedStyle ? getComputedStyle(el).display : el.style.display) || 'block';
                if (display === 'none') display = 'block';
                el.dataset.origDisplay = display;
                sections.push(el);
            });

            function hideAllSections() {
                sections.forEach(function (sec) {
                    sec.style.display = 'none';
                });
            }

            // Admin authentication
            var isAdminLoggedIn = false;
            
            window.showAdminLogin = function() {
                var modal = document.getElementById('adminLoginModal');
                if (modal) {
                    modal.style.display = 'block';
                    // Focus on email field
                    setTimeout(function() {
                        var emailField = document.getElementById('adminEmail');
                        if (emailField) emailField.focus();
                    }, 300);
                }
            };
            
            window.closeModal = function(modalId) {
                var modal = document.getElementById(modalId);
                if (modal) {
                    modal.style.display = 'none';
                    // Reset form
                    var form = modal.querySelector('form');
                    if (form) form.reset();
                }
            };
            
            // Close modal when clicking outside
            window.addEventListener('click', function(event) {
                var adminModal = document.getElementById('adminLoginModal');
                var batchModal = document.getElementById('batchModal');
                
                if (adminModal && event.target === adminModal) {
                    closeModal('adminLoginModal');
                }
                if (batchModal && event.target === batchModal) {
                    closeModal('batchModal');
                }
            });
            
            // Admin login form submission
            document.addEventListener('DOMContentLoaded', function() {
                var adminLoginForm = document.getElementById('adminLoginForm');
                if (adminLoginForm) {
                    adminLoginForm.addEventListener('submit', function (e) {
                        e.preventDefault();
                        
                        var email = document.getElementById('adminEmail').value;
                        var password = document.getElementById('adminPassword').value;
                        
                        console.log('Login attempt:', email); // Debug log
                        
                        // Check credentials
                        if (email === 'karatesubhash455@gmail.com' && password === 'karate@123') {
                            console.log('Login successful'); // Debug log
                            isAdminLoggedIn = true;
                            
                            // Store user info in session storage
                            sessionStorage.setItem('currentUser', JSON.stringify({
                                email: email,
                                role: 'admin',
                                name: 'Admin'
                            }));
                            
                            closeModal('adminLoginModal');
                            
                            // Show admin dashboard
                            var adminSection = document.getElementById('admin-dashboard');
                            if (adminSection) {
                                // Hide all sections first
                                var sections = document.querySelectorAll('section');
                                sections.forEach(function(section) {
                                    section.classList.remove('active');
                                    section.style.display = 'none';
                                });
                                
                                // Show admin section
                                adminSection.classList.add('active');
                                adminSection.style.display = 'block';
                            }
                            
                            // Load dashboard stats
                            if (typeof updateDashboardStats === 'function') {
                                updateDashboardStats();
                            }
                            
                            // Show success message
                            alert('Admin login successful!');
                        } else {
                            console.log('Login failed'); // Debug log
                            alert('Invalid email or password. Please try again.\n\nEmail: karatesubhash455@gmail.com\nPassword: karate@123');
                        }
                    });
                }
            });

            // Public: showSection used by many links/buttons
            window.showSection = function (sectionId) {
                console.log('showSection called with:', sectionId);
                
                // Check admin login before accessing admin dashboard
                if (sectionId === 'admin-dashboard') {
                    var currentUser = sessionStorage.getItem('currentUser');
                    console.log('Current user from sessionStorage:', currentUser);
                    if (!currentUser || JSON.parse(currentUser).role !== 'admin') {
                        console.log('Admin access denied, showing admin login modal');
                        showAdminLogin();
                        return;
                    }
                }
                
                console.log('Hiding all sections...');
                hideAllSections();
                var target = document.getElementById(sectionId);
                console.log('Target element:', target);
                if (target) {
                    target.style.display = target.dataset.origDisplay || 'block';
                    console.log('Section displayed successfully');
                } else {
                    console.log('Section not found!');
                }

                // Update nav active state
                var navLinks = document.querySelectorAll('.nav-links a');
                navLinks.forEach(function (link) {
                    var href = link.getAttribute('href') || '';
                    var onClick = link.getAttribute('onclick') || '';
                    if (href === '#' + sectionId || onClick.indexOf("'" + sectionId + "'") !== -1) {
                        link.classList.add('active');
                    } else {
                        link.classList.remove('active');
                    }
                });

                // Close mobile menu if open
                var navLinksEl = document.getElementById('navLinks');
                var overlayEl = document.getElementById('overlay');
            };

            // Admin and student dashboard view switching
            window.showAdminView = function (viewId, el) {
                var views = document.querySelectorAll('#admin-dashboard .admin-view');
                views.forEach(function (v) { v.classList.remove('active'); });
                var target = document.getElementById(viewId);
                if (target) target.classList.add('active');

                var items = document.querySelectorAll('#adminSidebar .menu-item');
                items.forEach(function (i) { i.classList.remove('active'); });
                if (el) el.classList.add('active');

                // Lazy-load data when switching admin views
                if (viewId === 'admin-instructors') loadInstructors();
                if (viewId === 'admin-batches') loadBatches();
                if (viewId === 'admin-admissions') loadAdmissions();
                                if (viewId === 'admin-fees-payments') loadAdminFeesPayments();
                if (viewId === 'admin-tournaments') loadTournaments();
                if (viewId === 'admin-store') loadStoreItems();
                if (viewId === 'admin-exams') loadExams();
                if (viewId === 'admin-announcements') loadAnnouncements();
                                if (viewId === 'admin-tournament-registrations') loadTournamentRegistrations();
                if (viewId === 'admin-exam-registrations') loadExamRegistrations();
                if (viewId === 'admin-store-orders') loadStoreOrders();
            };

            window.showStudentView = function (viewId, el) {
                var views = document.querySelectorAll('#student-dashboard .student-view');
                views.forEach(function (v) { v.classList.remove('active'); });
                var target = document.getElementById(viewId);
                if (target) target.classList.add('active');

                var items = document.querySelectorAll('#studentSidebar .menu-item');
                items.forEach(function (i) { i.classList.remove('active'); });
                if (el) el.classList.add('active');

                // Lazy-load data when switching student views
                if (viewId === 'student-tournaments') loadTournaments();
                if (viewId === 'student-store') loadStoreItems();
                if (viewId === 'student-exams') loadExams();
                if (viewId === 'student-announcements') loadAnnouncements();
            };

            // Modal helpers
            window.showModal = function (id) {
                var modal = document.getElementById(id);
                if (modal) {
                    modal.classList.add('show');
                    document.body.style.overflow = 'hidden';
                }
            };

            window.closeModal = function (id) {
                var modal = document.getElementById(id);
                if (modal) {
                    modal.classList.remove('show');
                    document.body.style.overflow = '';
                }
            };

            // Helpers
            function apiCall(method, url, body) {
                return fetch(url, {
                    method: method,
                    headers: { 'Content-Type': 'application/json' },
                    body: body ? JSON.stringify(body) : undefined
                }).then(async function (r) {
                    if (!r.ok) {
                        const txt = await r.text();
                        let msg = 'API error: ' + r.status;
                        try {
                            const j = JSON.parse(txt);
                            if (j.message) msg = j.message;
                        } catch (_) {}
                        throw new Error(msg);
                    }
                    return r.json();
                });
            }

            function safeSetHTML(id, html) {
                var el = document.getElementById(id);
                if (el) el.innerHTML = html;
            }

            function safeSetText(id, text) {
                var el = document.getElementById(id);
                if (el) el.textContent = text;
            }

            // Public home page loaders
            function loadHomeInstructors() {
                apiCall('GET', '/api/instructors').then(function (rows) {
                    var container = document.getElementById('instructors-list');
                    if (!container) return;
                    container.innerHTML = '';
                    rows.forEach(function (inst) {
                        var card = document.createElement('div');
                        card.className = 'info-card';
                        var photoHtml = inst.photo_url
                            ? '<img src="' + inst.photo_url + '" alt="' + inst.name + '" style="width:100%; height:180px; object-fit:cover; border-radius:8px 8px 0 0;">'
                            : '<div style="width:100%; height:180px; background:#222; border-radius:8px 8px 0 0; display:flex; align-items:center; justify-content:center; color:#999; font-size:3rem;">ðŸ‘¤</div>';
                        card.innerHTML = photoHtml +
                            '<div style="padding:1rem;"><h3 style="margin:0 0 0.5rem 0;">' + inst.name + '</h3><p style="margin:0 0 0.5rem 0; color:#aaa;">' + (inst.description || '') + '</p><div class="info-meta">Rank: ' + (inst.rank || '') + '</div></div>';
                        container.appendChild(card);
                    });
                }).catch(console.error);
            }

            function loadHomeCourses() {
                apiCall('GET', '/api/batches').then(function (rows) {
                    var container = document.getElementById('courses-list');
                    if (!container) return;
                    container.innerHTML = '';
                    rows.forEach(function (batch) {
                        var card = document.createElement('div');
                        card.className = 'info-card';
                        card.innerHTML = '<h3>' + batch.name + '</h3><p>' + (batch.description || '') + '</p><div class="info-meta"><span class="timing-label">Timing:</span> ' + (batch.timing || 'Not set') + '<br><span class="centre-label">Centre:</span> ' + (batch.centre || 'Not set') + '<br>Created: ' + new Date(batch.created_at).toLocaleDateString() + '</div>';
                        container.appendChild(card);
                    });
                }).catch(console.error);
            }

            // Instructors
            function loadInstructors() {
                console.log('Loading instructors...');
                apiCall('GET', '/api/instructors').then(function (rows) {
                    console.log('Instructors loaded:', rows);
                    renderAdminInstructorTable(rows);
                }).catch(function(error) {
                    console.error('Error loading instructors:', error);
                });
            }

            function renderAdminInstructorTable(data) {
                console.log('Rendering instructor table with data:', data);
                var tbody = document.querySelector('#admin-instructors-table tbody');
                console.log('Found tbody:', tbody);
                if (!tbody) {
                    console.log('Table tbody not found!');
                    return;
                }
                tbody.innerHTML = '';
                data.forEach(function (inst, idx) {
                    var tr = document.createElement('tr');
                    tr.innerHTML = '<td>' + inst.name + '</td><td>' + (inst.description || '') + '</td><td>' + (inst.rank || '') + '</td><td><button class="btn btn-outline" onclick="editInstructor(' + inst.id + ')">Edit</button> <button class="btn btn-primary" onclick="deleteInstructor(' + inst.id + ')">Delete</button></td>';
                    tbody.appendChild(tr);
                });
                console.log('Instructor table rendered successfully');
            }

            window.openInstructorForm = function () {
                console.log('openInstructorForm called');
                
                // Reset form first
                document.getElementById('instructorModalTitle').textContent = 'Add Instructor';
                document.getElementById('instructorForm').reset();
                document.getElementById('instructorId').value = '';
                
                // Reset photo upload label
                var photoLabel = document.querySelector('#instructorPhoto + .file-upload-label');
                if (photoLabel) {
                    photoLabel.innerHTML = `
                        <div class="file-upload-icon">
                            <i class="fas fa-cloud-upload-alt"></i>
                        </div>
                        <div class="file-upload-text">Click to upload photo</div>
                        <div class="file-upload-hint">PNG, JPG, JPEG up to 2MB</div>
                    `;
                }
                
                // Show modal using the existing showModal function
                window.showModal('instructorModal');
                console.log('Modal shown using showModal function');
                
                // Setup photo upload event listener immediately after modal is shown
                setTimeout(function() {
                    var instructorPhotoInput = document.getElementById('instructorPhoto');
                    console.log('Looking for instructor photo input...');
                    console.log('Found input:', instructorPhotoInput);
                    
                    if (instructorPhotoInput) {
                        console.log('Instructor photo input found in modal');
                        // Remove any existing listeners to avoid duplicates
                        instructorPhotoInput.removeEventListener('change', handleInstructorPhotoUpload);
                        // Add fresh listener
                        instructorPhotoInput.addEventListener('change', handleInstructorPhotoUpload);
                        console.log('Event listener attached successfully');
                        
                        // Also add click event to label as backup
                        var photoLabel = document.querySelector('#instructorPhoto + .file-upload-label');
                        if (photoLabel) {
                            photoLabel.addEventListener('click', function(e) {
                                console.log('Label clicked, triggering file input click');
                                e.preventDefault();
                                instructorPhotoInput.click();
                            });
                            console.log('Label click event attached');
                        }
                    } else {
                        console.log('Instructor photo input NOT found in modal');
                    }
                }, 100);
            };

            window.editInstructor = function (id) {
                console.log('editInstructor called with id:', id);
                apiCall('GET', '/api/instructors').then(function (rows) {
                    var inst = rows.find(function (r) { return r.id === id; });
                    if (!inst) return;
                    
                    // Set form values
                    document.getElementById('instructorModalTitle').textContent = 'Edit Instructor';
                    document.getElementById('instructorId').value = inst.id;
                    document.getElementById('instructorName').value = inst.name || '';
                    document.getElementById('instructorDescription').value = inst.description || '';
                    document.getElementById('instructorRank').value = inst.rank || '';
                    
                    // Show existing photo if available
                    var photoLabel = document.querySelector('#instructorPhoto + .file-upload-label');
                    if (photoLabel) {
                        if (inst.photo_url) {
                            photoLabel.innerHTML = `
                                <img src="${inst.photo_url}" alt="Current Photo" style="width: 100%; max-height: 200px; object-fit: cover; border-radius: 8px;">
                                <div class="file-upload-text" style="margin-top: 10px;">Click to change photo</div>
                                <div class="file-upload-hint">Current photo loaded</div>
                            `;
                        } else {
                            photoLabel.innerHTML = `
                                <div class="file-upload-icon">
                                    <i class="fas fa-cloud-upload-alt"></i>
                                </div>
                                <div class="file-upload-text">Click to upload photo</div>
                                <div class="file-upload-hint">PNG, JPG up to 2MB</div>
                            `;
                        }
                    }
                    
                    // Show modal using the existing showModal function
                    window.showModal('instructorModal');
                    console.log('Edit modal shown using showModal function');
                    
                    // Setup photo upload event listener immediately after modal is shown
                    setTimeout(function() {
                        var instructorPhotoInput = document.getElementById('instructorPhoto');
                        console.log('Looking for instructor photo input in edit...');
                        console.log('Found input in edit:', instructorPhotoInput);
                        
                        if (instructorPhotoInput) {
                            console.log('Instructor photo input found in edit modal');
                            // Remove any existing listeners to avoid duplicates
                            instructorPhotoInput.removeEventListener('change', handleInstructorPhotoUpload);
                            // Add fresh listener
                            instructorPhotoInput.addEventListener('change', handleInstructorPhotoUpload);
                            console.log('Event listener attached successfully in edit');
                            
                            // Also add click event to label as backup
                            var photoLabel = document.querySelector('#instructorPhoto + .file-upload-label');
                            if (photoLabel) {
                                photoLabel.addEventListener('click', function(e) {
                                    console.log('Label clicked in edit, triggering file input click');
                                    e.preventDefault();
                                    instructorPhotoInput.click();
                                });
                                console.log('Label click event attached in edit');
                            }
                        } else {
                            console.log('Instructor photo input NOT found in edit modal');
                        }
                    }, 100);
                }).catch(console.error);
            };

            // Simple instructor photo upload function
            window.previewInstructorPhoto = function(input) {
                console.log('Photo input changed:', input.files);
                
                if (input.files && input.files[0]) {
                    var file = input.files[0];
                    
                    // Check file type
                    if (!file.type.match('image.*')) {
                        alert('Please select an image file');
                        input.value = '';
                        return;
                    }
                    
                    // Check file size (2MB limit)
                    if (file.size > 2 * 1024 * 1024) {
                        alert('Photo size must be less than 2MB');
                        input.value = '';
                        return;
                    }
                    
                    // Read and display preview
                    var reader = new FileReader();
                    reader.onload = function(e) {
                        var preview = document.getElementById('photoPreview');
                        if (preview) {
                            preview.innerHTML = '<img src="' + e.target.result + '" style="width: 100%; max-height: 200px; object-fit: cover; border-radius: 8px;">';
                            preview.style.display = 'block';
                        }
                    };
                    reader.readAsDataURL(file);
                }
            };

            // Create the photo upload handler function
            window.handleInstructorPhotoUpload = function (e) {
                console.log('=== PHOTO UPLOAD STARTED ===');
                console.log('Event target:', e.target);
                console.log('Files:', e.target.files);
                
                var file = e.target.files && e.target.files[0];
                if (!file) {
                    console.log('No file selected');
                    return;
                }
                
                console.log('File selected:', file.name, file.size, file.type);
                
                // Check file type
                if (!file.type.match('image.*')) {
                    alert('Please select an image file');
                    e.target.value = '';
                    return;
                }
                
                // Check file size
                if (file.size > 2 * 1024 * 1024) {
                    alert('Photo size must be less than 2MB');
                    e.target.value = '';
                    return;
                }
                
                console.log('File validation passed, starting FileReader...');
                var reader = new FileReader();
                reader.onload = function (evt) {
                    console.log('FileReader completed successfully');
                    console.log('Data URL length:', evt.target.result.length);
                    
                    var label = document.querySelector('#instructorPhoto + .file-upload-label');
                    if (!label) {
                        console.log('ERROR: Label not found');
                        return;
                    }
                    
                    console.log('Label found, updating preview');
                    // Create preview
                    label.innerHTML = `
                        <img src="${evt.target.result}" alt="Photo Preview" style="width: 100%; max-height: 200px; object-fit: cover; border-radius: 8px;">
                        <div class="file-upload-text" style="margin-top: 10px;">Click to change photo</div>
                        <div class="file-upload-hint">${file.name}</div>
                    `;
                    console.log('Preview updated successfully');
                };
                
                reader.onerror = function(error) {
                    console.error('FileReader error:', error);
                    alert('Error reading file');
                };
                
                reader.readAsDataURL(file);
                console.log('FileReader started');
            };

            // Test function to manually trigger file input
            window.testInstructorPhotoUpload = function() {
                console.log('Testing instructor photo upload');
                var input = document.getElementById('instructorPhoto');
                if (input) {
                    console.log('Triggering click on input');
                    input.click();
                } else {
                    console.log('Input not found');
                }
            };

            window.saveInstructor = function() {
                var id = document.getElementById('instructorId').value;
                var name = document.getElementById('instructorName').value;
                var description = document.getElementById('instructorDescription').value;
                var rank = document.getElementById('instructorRank').value;
                
                console.log('Saving instructor:', { id, name, description, rank });
                
                if (!name) {
                    alert('Instructor name is required');
                    return;
                }
                
                // Simple photo handling - just use FileReader without compression for now
                var photoInput = document.getElementById('instructorPhoto');
                console.log('Photo input:', photoInput);
                console.log('Photo input files:', photoInput ? photoInput.files : 'No input found');
                
                if (photoInput && photoInput.files && photoInput.files[0]) {
                    var file = photoInput.files[0];
                    console.log('Processing file:', file.name, file.size);
                    
                    if (file.size > 2 * 1024 * 1024) { // 2MB limit
                        alert('Photo size must be less than 2MB');
                        return;
                    }
                    
                    var reader = new FileReader();
                    reader.onload = function(e) {
                        console.log('File reader completed');
                        var photoData = e.target.result;
                        console.log('Photo data length:', photoData.length);
                        
                        var data = {
                            name: name,
                            description: description,
                            rank: rank,
                            photo_url: photoData
                        };
                        
                        var method = id ? 'PUT' : 'POST';
                        var url = id ? '/api/instructors/' + id : '/api/instructors';
                        
                        console.log('Sending request:', method, url, data.photo_url.length > 0 ? 'with photo' : 'no photo');
                        
                        apiCall(method, url, data)
                            .then(function () { 
                                console.log('Instructor saved successfully');
                                loadInstructors(); 
                                loadHomeInstructors();
                                window.closeModal('instructorModal');
                            })
                            .catch(function(error) {
                                console.error('Error saving instructor:', error);
                            });
                    };
                    reader.readAsDataURL(file);
                } else {
                    // No photo selected
                    console.log('No photo file selected');
                    
                    var data = {
                        name: name,
                        description: description,
                        rank: rank,
                        photo_url: ''
                    };
                    
                    var method = id ? 'PUT' : 'POST';
                    var url = id ? '/api/instructors/' + id : '/api/instructors';
                    
                    console.log('Sending request without photo:', method, url);
                    
                    apiCall(method, url, data)
                        .then(function () { 
                            console.log('Instructor saved successfully without photo');
                            loadInstructors(); 
                            loadHomeInstructors();
                            window.closeModal('instructorModal');
                        })
                        .catch(function(error) {
                            console.error('Error saving instructor:', error);
                        });
                }
            };

            // Add proper close modal function for instructor modal
            window.closeInstructorModal = function() {
                window.closeModal('instructorModal');
            };

            window.deleteInstructor = function (id) {
                if (!confirm('Delete this instructor?')) return;
                apiCall('DELETE', '/api/instructors/' + id)
                    .then(function () { loadInstructors(); loadHomeInstructors(); })
                    .catch(console.error);
            };

            // Batches
            function loadBatches() {
                apiCall('GET', '/api/batches').then(function (rows) {
                    renderAdminBatches(rows);
                    updateDashboardStats();
                }).catch(console.error);
            }

            function renderAdminBatches(data) {
                var container = document.getElementById('admin-batches-list');
                if (!container) return;
                container.innerHTML = '';
                data.forEach(function (batch) {
                    var card = document.createElement('div');
                    card.className = 'info-card';
                    card.innerHTML = '<h3>' + batch.name + '</h3><p>' + (batch.description || '') + '</p><div class="info-meta"><span class="timing-label">Timing:</span> ' + (batch.timing || 'Not set') + '<br><span class="centre-label">Centre:</span> ' + (batch.centre || 'Not set') + '<br>Created: ' + new Date(batch.created_at).toLocaleDateString() + '</div><div class="form-actions" style="margin-top: 1rem;"><button class="btn btn-outline" onclick="editBatch(' + batch.id + ')">Edit</button> <button class="btn btn-primary" onclick="deleteBatch(' + batch.id + ')">Delete</button></div>';
                    container.appendChild(card);
                });
            }

            window.openBatchForm = function () {
                // Reset form first
                document.getElementById('batchModalTitle').textContent = 'Add Batch';
                document.getElementById('batchForm').reset();
                document.getElementById('batchId').value = '';
                
                // Show modal using proper showModal function
                window.showModal('batchModal');
                
                // Focus on name field
                setTimeout(function() {
                    var nameField = document.getElementById('batchModalName');
                    if (nameField) nameField.focus();
                }, 300);
            };

            window.closeBatchModal = function() {
                window.closeModal('batchModal');
            };

            window.saveBatch = function() {
                var batchId = document.getElementById('batchId').value;
                var name = document.getElementById('batchModalName').value.trim();
                var description = document.getElementById('batchModalDescription').value.trim();
                var timing = document.getElementById('batchModalTiming').value.trim();
                var centre = document.getElementById('batchModalCentre').value.trim();
                
                // Debug logging
                console.log('saveBatch debug:', {
                    batchId: batchId,
                    name: name,
                    description: description,
                    timing: timing,
                    centre: centre,
                    timingElement: document.getElementById('batchModalTiming'),
                    timingValue: document.getElementById('batchModalTiming').value
                });
                
                // Validation
                if (!name) {
                    alert('Batch name is required');
                    return;
                }
                if (!timing) {
                    alert('Timing is required');
                    return;
                }
                if (!centre) {
                    alert('Centre is required');
                    return;
                }
                
                var batchData = {
                    name: name,
                    description: description,
                    timing: timing,
                    centre: centre
                };
                
                var isEdit = batchId !== '';
                var url = isEdit ? '/api/batches/' + batchId : '/api/batches';
                var method = isEdit ? 'PUT' : 'POST';
                
                apiCall(method, url, batchData)
                    .then(function() { 
                        closeBatchModal();
                        loadBatches(); 
                        loadHomeCourses(); 
                    })
                    .catch(function(error) {
                        console.error('Error saving batch:', error);
                        alert('Error saving batch: ' + (error.message || 'Unknown error'));
                    });
            };

            window.editBatch = function (id) {
                apiCall('GET', '/api/batches').then(function (rows) {
                    var batch = rows.find(function (r) { return r.id === id; });
                    if (!batch) return;
                    
                    // Set form values for editing
                    document.getElementById('batchModalTitle').textContent = 'Edit Batch';
                    document.getElementById('batchId').value = batch.id;
                    document.getElementById('batchModalName').value = batch.name || '';
                    document.getElementById('batchModalDescription').value = batch.description || '';
                    document.getElementById('batchModalTiming').value = batch.timing || '';
                    document.getElementById('batchModalCentre').value = batch.centre || '';
                    
                    // Show modal using proper showModal function
                    window.showModal('batchModal');
                    
                    // Focus on name field
                    setTimeout(function() {
                        var nameField = document.getElementById('batchModalName');
                        if (nameField) nameField.focus();
                    }, 300);
                }).catch(console.error);
            };

            window.deleteBatch = function (id) {
                if (!confirm('Delete this batch?')) return;
                apiCall('DELETE', '/api/batches/' + id)
                    .then(function () { loadBatches(); loadHomeCourses(); })
                    .catch(console.error);
            };

            // Admissions
            function loadAdmissions() {
                apiCall('GET', '/api/admissions').then(function (rows) {
                    renderAdminAdmissions(rows);
                    updateDashboardStats();
                }).catch(console.error);
            }

            function renderAdminAdmissions(data) {
                var tbody = document.querySelector('#admin-admissions-table tbody');
                var empty = document.getElementById('admin-admissions-empty');
                if (!tbody) return;
                tbody.innerHTML = '';
                data.forEach(function (a) {
                    var tr = document.createElement('tr');
                    tr.innerHTML = '<td>' + a.first_name + ' ' + a.last_name + '</td><td>' + a.age + '</td><td>' + a.belt_level + '</td><td>' + a.phone + '</td><td>' + (a.address || '') + '</td><td><button class="btn btn-outline" onclick="viewAdmission(' + a.id + ')">View</button> <button class="btn btn-primary" onclick="downloadAdmissionPDF(' + a.id + ')">PDF</button> <button class="btn btn-primary" onclick="deleteAdmission(' + a.id + ')">Delete</button></td>';
                    tbody.appendChild(tr);
                });
                if (empty) empty.style.display = data.length ? 'none' : 'block';
            }

            window.deleteAdmission = function (id) {
                if (!confirm('Delete this admission?')) return;
                apiCall('DELETE', '/api/admissions/' + id)
                    .then(function () { loadAdmissions(); })
                    .catch(console.error);
            };

            window.viewAdmission = function (id) {
                apiCall('GET', '/api/admissions').then(function (rows) {
                    var a = rows.find(function (r) { return r.id === id; });
                    if (!a) return;
                    alert('Name: ' + a.first_name + ' ' + a.last_name + '\nAge: ' + a.age + '\nBelt: ' + a.belt_level + '\nEmail: ' + a.email + '\nPhone: ' + a.phone + '\nAddress: ' + (a.address || ''));
                }).catch(console.error);
            };

            window.downloadAdmissionPDF = function (id) {
                apiCall('GET', '/api/admissions').then(function (rows) {
                    var a = rows.find(function (r) { return r.id === id; });
                    if (!a) return;
                    generateAdmissionPDF(a);
                }).catch(console.error);
            };

            function generateAdmissionPDF(data) {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                // Set up colors
                const primaryColor = [212, 175, 55]; // #d4af37
                
                // Add logo at the top (properly fitted)
                try {
                    const logoImg = new Image();
                    logoImg.crossOrigin = "anonymous";
                    logoImg.onload = function() {
                        // Create canvas with proper dimensions
                        const canvas = document.createElement('canvas');
                        const ctx = canvas.getContext('2d');
                        canvas.width = 120;
                        canvas.height = 120;
                        
                        // Enable image smoothing for better quality
                        ctx.imageSmoothingEnabled = true;
                        ctx.imageSmoothingQuality = 'high';
                        
                        // Calculate proper fit - use the smaller dimension
                        const targetSize = Math.min(logoImg.width, logoImg.height);
                        const sx = (logoImg.width - targetSize) / 2;
                        const sy = (logoImg.height - targetSize) / 2;
                        
                        // Draw logo to fill the canvas perfectly
                        ctx.drawImage(logoImg, sx, sy, targetSize, targetSize, 0, 0, 120, 120);
                        
                        // Add to PDF with proper size
                        const logoDataUrl = canvas.toDataURL('image/png', 1.0);
                        doc.addImage(logoDataUrl, 'PNG', 75, 10, 60, 60);
                        
                        // Continue with content after logo loads
                        addPDFContent();
                    };
                    logoImg.onerror = function() {
                        // If logo fails to load, continue without it
                        addPDFContent();
                    };
                    logoImg.src = window.location.origin + '/image.png';
                } catch (error) {
                    // If logo loading fails, continue without it
                    addPDFContent();
                }
                
                function addPDFContent() {
                    // Header
                    doc.setTextColor(primaryColor[0], primaryColor[1], primaryColor[2]);
                    doc.setFontSize(20);
                    doc.setFont(undefined, 'bold');
                    doc.text('WTSKF-GOA', 105, 80, { align: 'center' });
                    
                    doc.setFontSize(10);
                    doc.setFont(undefined, 'normal');
                    doc.text('World Traditional Shotokan Karate Federation - Goa', 105, 87, { align: 'center' });
                    
                    doc.setFontSize(14);
                    doc.setFont(undefined, 'bold');
                    doc.text('Admission Form', 105, 97, { align: 'center' });
                    
                    // Draw line
                    doc.setDrawColor(primaryColor[0], primaryColor[1], primaryColor[2]);
                    doc.setLineWidth(0.5);
                    doc.line(20, 103, 190, 103);
                    
                    // Form content
                    doc.setTextColor(0, 0, 0);
                    doc.setFontSize(11);
                    
                    let yPosition = 115;
                    const lineHeight = 10;
                    
                    // Left column content
                    const leftCol = 20;
                    const rightCol = 110;
                    
                    // Name
                    doc.setFont(undefined, 'bold');
                    doc.text('Name:', leftCol, yPosition);
                    doc.setFont(undefined, 'normal');
                    doc.text(data.first_name + ' ' + data.last_name, leftCol + 30, yPosition);
                    yPosition += lineHeight;
                    
                    // Age
                    doc.setFont(undefined, 'bold');
                    doc.text('Age:', leftCol, yPosition);
                    doc.setFont(undefined, 'normal');
                    doc.text(data.age.toString(), leftCol + 30, yPosition);
                    yPosition += lineHeight;
                    
                    // Belt Level
                    doc.setFont(undefined, 'bold');
                    doc.text('Belt Level:', leftCol, yPosition);
                    doc.setFont(undefined, 'normal');
                    doc.text(data.belt_level, leftCol + 30, yPosition);
                    yPosition += lineHeight;
                    
                    // Email
                    doc.setFont(undefined, 'bold');
                    doc.text('Email:', leftCol, yPosition);
                    doc.setFont(undefined, 'normal');
                    doc.text(data.email, leftCol + 30, yPosition);
                    yPosition += lineHeight;
                    
                    // Phone
                    doc.setFont(undefined, 'bold');
                    doc.text('Phone:', leftCol, yPosition);
                    doc.setFont(undefined, 'normal');
                    doc.text(data.phone, leftCol + 30, yPosition);
                    yPosition += lineHeight;
                    
                    // Address
                    doc.setFont(undefined, 'bold');
                    doc.text('Address:', leftCol, yPosition);
                    doc.setFont(undefined, 'normal');
                    const addressText = data.address || 'N/A';
                    if (addressText.length > 50) {
                        const lines = doc.splitTextToSize(addressText, 60);
                        doc.text(lines, leftCol + 30, yPosition);
                        yPosition += (lines.length * 7);
                    } else {
                        doc.text(addressText, leftCol + 30, yPosition);
                        yPosition += lineHeight;
                    }
                    
                    // Centre
                    doc.setFont(undefined, 'bold');
                    doc.text('Centre:', leftCol, yPosition);
                    doc.setFont(undefined, 'normal');
                    const centreText = data.centre === 'st.cruz' ? 'St. Cruz' : 'Girim';
                    doc.text(centreText, leftCol + 30, yPosition);
                    yPosition += lineHeight;
                    
                    // Batch Timing (properly formatted)
                    doc.setFont(undefined, 'bold');
                    doc.text('Batch Timing:', leftCol, yPosition);
                    doc.setFont(undefined, 'normal');
                    let batchText = '';
                    if (data.batch_timing === 'morning-6-7') batchText = 'Morning 6:00 AM - 7:00 AM';
                    else if (data.batch_timing === 'morning-7-8') batchText = 'Morning 7:00 AM - 8:00 AM';
                    else if (data.batch_timing === 'evening-5-6') batchText = 'Evening 5:00 PM - 6:00 PM';
                    else if (data.batch_timing === 'evening-6-7') batchText = 'Evening 6:00 PM - 7:00 PM';
                    else if (data.batch_timing === 'evening-7-8') batchText = 'Evening 7:00 PM - 8:00 PM';
                    else batchText = data.batch_timing;
                    doc.text(batchText, leftCol + 30, yPosition);
                    yPosition += lineHeight;
                    
                    // Add photo on right side if available
                    if (data.photo_url && data.photo_url !== '') {
                        try {
                            // Add photo to right side (square shape)
                            doc.addImage(data.photo_url, 'JPEG', rightCol, 115, 60, 60);
                            
                            // Photo border
                            doc.setDrawColor(200);
                            doc.setLineWidth(0.5);
                            doc.rect(rightCol, 115, 60, 60);
                            
                            // Photo label
                            doc.setFontSize(9);
                            doc.setTextColor(100);
                            doc.text('Student Photo', rightCol + 30, 185, { align: 'center' });
                        } catch (error) {
                            // If photo fails to load, continue without it
                            console.log('Could not add photo to PDF:', error);
                        }
                    }
                    
                    // Submitted date
                    yPosition += 10;
                    doc.setFont(undefined, 'bold');
                    doc.text('Submitted:', leftCol, yPosition);
                    doc.setFont(undefined, 'normal');
                    doc.text(new Date(data.created_at).toLocaleString(), leftCol + 30, yPosition);
                    yPosition += 30;
                    
                    // Signature section
                    doc.setFontSize(11);
                    doc.setTextColor(0, 0, 0);
                    
                    // Draw signature line
                    doc.setDrawColor(0);
                    doc.setLineWidth(0.5);
                    
                    // Student signature
                    doc.line(leftCol, yPosition, leftCol + 60, yPosition);
                    doc.setFont(undefined, 'normal');
                    doc.setFontSize(10);
                    doc.text('Student Signature', leftCol + 15, yPosition + 5);
                    
                    // Administrator signature
                    doc.line(rightCol, yPosition, rightCol + 60, yPosition);
                    doc.text('Administrator Signature', rightCol + 10, yPosition + 5);
                    
                    // Footer
                    doc.setFontSize(9);
                    doc.setTextColor(100);
                    doc.text('Â© 2024 WTSKF-GOA. All rights reserved.', 105, 280, { align: 'center' });
                    
                    // Save the PDF
                    doc.save('admission_' + data.id + '.pdf');
                }
            }

            
            // ---- Fees Payments (Admin) ----
            var feesPaymentsState = { rows: [], sortKey: 'payment_datetime', sortDir: 'desc', q: '', centre: '', batch: '' };

            function _feesCompare(a, b, key) {
                var va = a[key] || ''; var vb = b[key] || '';
                if (key === 'payment_datetime') return new Date(va) - new Date(vb);
                return String(va).localeCompare(String(vb));
            }

            function renderAdminFeesPayments() {
                var tbody = document.getElementById('admin-fees-tbody');
                if (!tbody) return;
                var rows = feesPaymentsState.rows.slice();
                var q = (feesPaymentsState.q || '').toLowerCase();
                if (q) {
                    rows = rows.filter(function(r){
                        return (r.full_name||'').toLowerCase().includes(q)
                            || (r.phone||'').toLowerCase().includes(q)
                            || (JSON.stringify(r.validation_json||'')).toLowerCase().includes(q);
                    });
                }
                if (feesPaymentsState.centre) rows = rows.filter(function(r){ return r.centre === feesPaymentsState.centre; });
                if (feesPaymentsState.batch) rows = rows.filter(function(r){ return r.batch_name === feesPaymentsState.batch; });
                rows.sort(function(a,b){ return _feesCompare(a,b,feesPaymentsState.sortKey); });
                if (feesPaymentsState.sortDir === 'desc') rows.reverse();

                function getBatchLabel(batchName) {
                    var key = String(batchName || '')
                        .trim()
                        .toLowerCase()
                        .replace(/[^a-z0-9]/g, '');
                    var map = {
                        'batch1': 'Batch 1',
                        'batch2': 'Batch 2',
                        'batch3': 'Batch 3',
                        'batch4': 'Batch 4',
                        'batcha1': 'Batch A1',
                        'stcruz1': 'Batch 1',
                        'stcruz2': 'Batch 2',
                        'stcruz3': 'Batch 3',
                        'stcruz4': 'Batch 4',
                        'guirima1': 'Batch A1'
                    };
                    return map[key] || (batchName || '');
                }

                function formatFeesDateTime(v) {
                    if (!v) return '';
                    var dt = (v instanceof Date) ? v : new Date(v);
                    if (isNaN(dt.getTime()) && typeof v === 'string') {
                        var s = v.trim();
                        if (/^\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}/.test(s)) {
                            dt = new Date(s.replace(' ', 'T') + 'Z');
                        }
                    }
                    if (isNaN(dt.getTime())) return String(v);
                    return dt.toLocaleString('en-IN', {
                        timeZone: 'Asia/Kolkata',
                        year: 'numeric',
                        month: '2-digit',
                        day: '2-digit',
                        hour: '2-digit',
                        minute: '2-digit',
                        second: '2-digit'
                    });
                }

                tbody.innerHTML = rows.map(function(r){
                    var dtStr = formatFeesDateTime(r.payment_datetime);
                    var status = r.status || 'Pending Verification';
                    return '<tr>'+
                        '<td>'+(r.full_name||'')+'</td>'+
                        '<td>'+(r.phone||'')+'</td>'+
                        '<td>'+getBatchLabel(r.batch_name)+'</td>'+
                        '<td>'+(r.centre||'')+'</td>'+
                        '<td>'+dtStr+'</td>'+
                        '<td>'+status+'</td>'+
                    '</tr>';
                }).join('');

                var centreSel = document.getElementById('feesFilterCentre');
                var batchSel = document.getElementById('feesFilterBatch');
                if (centreSel && batchSel && centreSel.options.length <= 1) {
                    var centres = Array.from(new Set(feesPaymentsState.rows.map(function(r){ return r.centre; }).filter(Boolean)));
                    centres.forEach(function(c){ var o=document.createElement('option'); o.value=c; o.textContent=c; centreSel.appendChild(o); });
                    var batches = Array.from(new Set(feesPaymentsState.rows.map(function(r){ return r.batch_name; }).filter(Boolean)));
                    batches.forEach(function(b){ var o=document.createElement('option'); o.value=b; o.textContent=getBatchLabel(b); batchSel.appendChild(o); });
                }
            }

            function attachAdminFeesEvents() {
                var search = document.getElementById('feesSearch');
                var centreSel = document.getElementById('feesFilterCentre');
                var batchSel = document.getElementById('feesFilterBatch');
                var table = document.getElementById('admin-fees-table');
                if (search && !search._feesBound) { search._feesBound = true; search.addEventListener('input', function(){ feesPaymentsState.q = this.value; renderAdminFeesPayments(); }); }
                if (centreSel && !centreSel._feesBound) { centreSel._feesBound = true; centreSel.addEventListener('change', function(){ feesPaymentsState.centre = this.value; renderAdminFeesPayments(); }); }
                if (batchSel && !batchSel._feesBound) { batchSel._feesBound = true; batchSel.addEventListener('change', function(){ feesPaymentsState.batch = this.value; renderAdminFeesPayments(); }); }
                if (table) table.querySelectorAll('th[data-sort]').forEach(function(th){
                    if (th._feesBound) return; th._feesBound = true;
                    th.style.cursor = 'pointer';
                    th.addEventListener('click', function(){
                        var key = this.getAttribute('data-sort');
                        if (feesPaymentsState.sortKey === key) {
                            feesPaymentsState.sortDir = feesPaymentsState.sortDir === 'asc' ? 'desc' : 'asc';
                        } else {
                            feesPaymentsState.sortKey = key; feesPaymentsState.sortDir = 'asc';
                        }
                        renderAdminFeesPayments();
                    });
                });
            }

            function loadAdminFeesPayments() {
                apiCall('GET', '/api/fees-payments').then(function(rows){
                    feesPaymentsState.rows = rows || [];
                    attachAdminFeesEvents();
                    renderAdminFeesPayments();
                }).catch(console.error);
            }

            window.downloadFeesCsv = function(){
                apiCall('GET', '/api/fees-payments/excel?format=csv').then(function(resp){
                    if (!resp || !resp.url) return;
                    var a = document.createElement('a');
                    a.href = resp.url;
                    a.download = 'fees_payments.csv';
                    document.body.appendChild(a);
                    a.click();
                    a.remove();
                }).catch(console.error);
            };

            // Tournaments
            function loadTournaments() {
                apiCall('GET', '/api/tournaments').then(function (rows) {
                    renderTournaments(rows);
                    updateDashboardStats();
                }).catch(console.error);
            }

            function renderTournaments(data) {
                var adminList = document.getElementById('admin-tournaments-list');
                var studentList = document.getElementById('student-tournaments-list');
                if (adminList) adminList.innerHTML = '';
                if (studentList) studentList.innerHTML = '';
                data.forEach(function (t) {
                    var cardHtml = '<div class="info-card"><h3>' + t.title + '</h3><p>' + (t.description || '') + '</p><div class="info-meta">' + (t.location || '') + ' | ' + t.date + '</div><div class="form-actions" style="margin-top: 1rem;"><button class="btn btn-primary" onclick="showTournamentRegistrationModal(' + t.id + ', \'' + t.title + '\')">Register</button></div></div>';
                    var adminCardHtml = '<div class="info-card"><h3>' + t.title + '</h3><p>' + (t.description || '') + '</p><div class="info-meta">' + (t.location || '') + ' | ' + t.date + '</div><div class="form-actions" style="margin-top: 1rem;"><button class="btn btn-outline" onclick="editTournament(' + t.id + ')">Edit</button> <button class="btn btn-primary" onclick="deleteTournament(' + t.id + ')">Delete</button></div></div>';
                    if (adminList) adminList.insertAdjacentHTML('beforeend', adminCardHtml);
                    if (studentList) studentList.insertAdjacentHTML('beforeend', cardHtml);
                });
                safeSetText('student-registered-tournaments', data.length);
            }

            window.openTournamentForm = function () {
                var title = prompt('Tournament title');
                if (!title) return;
                var location = prompt('Location') || '';
                var date = prompt('Date (YYYY-MM-DD)');
                if (!date) return;
                var description = prompt('Short description') || '';
                apiCall('POST', '/api/tournaments', { title: title, location: location, date: date, description: description })
                    .then(function () { loadTournaments(); })
                    .catch(console.error);
            };

            window.editTournament = function (id) {
                apiCall('GET', '/api/tournaments').then(function (rows) {
                    var t = rows.find(function (r) { return r.id === id; });
                    if (!t) return;
                    var title = prompt('Tournament title', t.title);
                    if (!title) return;
                    var location = prompt('Location', t.location) || '';
                    var date = prompt('Date (YYYY-MM-DD)', t.date);
                    if (!date) return;
                    var description = prompt('Short description', t.description) || '';
                    apiCall('PUT', '/api/tournaments/' + id, { title: title, location: location, date: date, description: description })
                        .then(function () { loadTournaments(); })
                        .catch(console.error);
                }).catch(console.error);
            };

            window.deleteTournament = function (id) {
                if (!confirm('Delete this tournament?')) return;
                apiCall('DELETE', '/api/tournaments/' + id)
                    .then(function () { loadTournaments(); })
                    .catch(console.error);
            };

            // Store Items
            function loadStoreItems() {
                apiCall('GET', '/api/store-items').then(function (rows) {
                    renderStoreItems(rows);
                    updateDashboardStats();
                }).catch(console.error);
            }

            function renderStoreItems(data) {
                var adminList = document.getElementById('admin-store-list');
                var studentList = document.getElementById('student-store-list');
                if (adminList) adminList.innerHTML = '';
                if (studentList) studentList.innerHTML = '';
                data.forEach(function (item) {
                    var cardHtml = '<div class="info-card"><h3>' + item.name + '</h3><p>' + (item.description || '') + '</p><div class="info-meta">Price: ' + item.price + '</div><div class="form-actions" style="margin-top: 1rem;"><button class="btn btn-primary" onclick="showStoreOrderModal(' + item.id + ', \'' + item.name + '\', ' + item.price + ')">Order Now</button></div></div>';
                    var adminCardHtml = '<div class="info-card"><h3>' + item.name + '</h3><p>' + (item.description || '') + '</p><div class="info-meta">Price: ' + item.price + '</div><div class="form-actions" style="margin-top: 1rem;"><button class="btn btn-outline" onclick="editStoreItem(' + item.id + ')">Edit</button> <button class="btn btn-primary" onclick="deleteStoreItem(' + item.id + ')">Delete</button></div></div>';
                    if (adminList) adminList.insertAdjacentHTML('beforeend', adminCardHtml);
                    if (studentList) studentList.insertAdjacentHTML('beforeend', cardHtml);
                });
                safeSetText('student-store-items', data.length);
            }

            window.openStoreItemForm = function () {
                var name = prompt('Product name');
                if (!name) return;
                var price = prompt('Price');
                if (price == null) return;
                var description = prompt('Short description') || '';
                apiCall('POST', '/api/store-items', { name: name, price: price, description: description })
                    .then(function () { loadStoreItems(); })
                    .catch(console.error);
            };

            window.editStoreItem = function (id) {
                apiCall('GET', '/api/store-items').then(function (rows) {
                    var item = rows.find(function (r) { return r.id === id; });
                    if (!item) return;
                    var name = prompt('Product name', item.name);
                    if (!name) return;
                    var price = prompt('Price', item.price);
                    if (price == null) return;
                    var description = prompt('Short description', item.description) || '';
                    apiCall('PUT', '/api/store-items/' + id, { name: name, price: price, description: description })
                        .then(function () { loadStoreItems(); })
                        .catch(console.error);
                }).catch(console.error);
            };

            window.deleteStoreItem = function (id) {
                if (!confirm('Delete this store item?')) return;
                apiCall('DELETE', '/api/store-items/' + id)
                    .then(function () { loadStoreItems(); })
                    .catch(console.error);
            };

            // Exams
            function loadExams() {
                apiCall('GET', '/api/exams').then(function (rows) {
                    renderExams(rows);
                    updateDashboardStats();
                }).catch(console.error);
            }

            function renderExams(data) {
                var adminList = document.getElementById('admin-exams-list');
                var studentList = document.getElementById('student-exams-list');
                if (adminList) adminList.innerHTML = '';
                if (studentList) studentList.innerHTML = '';
                data.forEach(function (exam) {
                    var cardHtml = '<div class="info-card"><h3>' + exam.title + '</h3><p>' + (exam.grade_info || '') + '</p><div class="info-meta">Date: ' + exam.date + ' | Eligible: ' + exam.belt + '</div><div class="form-actions" style="margin-top: 1rem;"><button class="btn btn-primary" onclick="showExamRegistrationModal(' + exam.id + ', \'' + exam.title + '\')">Register</button></div></div>';
                    var adminCardHtml = '<div class="info-card"><h3>' + exam.title + '</h3><p>' + (exam.grade_info || '') + '</p><div class="info-meta">Date: ' + exam.date + ' | Eligible: ' + exam.belt + '</div><div class="form-actions" style="margin-top: 1rem;"><button class="btn btn-outline" onclick="editExam(' + exam.id + ')">Edit</button> <button class="btn btn-primary" onclick="deleteExam(' + exam.id + ')">Delete</button></div></div>';
                    if (adminList) adminList.insertAdjacentHTML('beforeend', adminCardHtml);
                    if (studentList) studentList.insertAdjacentHTML('beforeend', cardHtml);
                });
                safeSetText('admin-upcoming-exams', data.length);
                safeSetText('student-upcoming-exams', data.length);
            }

            window.openExamForm = function () {
                var title = prompt('Exam title');
                if (!title) return;
                var gradeInfo = prompt('Grade info') || '';
                var date = prompt('Exam date (YYYY-MM-DD)');
                if (!date) return;
                var belt = prompt('Belt-level eligibility');
                if (!belt) return;
                apiCall('POST', '/api/exams', { title: title, grade_info: gradeInfo, date: date, belt: belt })
                    .then(function () { loadExams(); })
                    .catch(console.error);
            };

            window.editExam = function (id) {
                apiCall('GET', '/api/exams').then(function (rows) {
                    var exam = rows.find(function (r) { return r.id === id; });
                    if (!exam) return;
                    var title = prompt('Exam title', exam.title);
                    if (!title) return;
                    var gradeInfo = prompt('Grade info', exam.grade_info) || '';
                    var date = prompt('Exam date (YYYY-MM-DD)', exam.date);
                    if (!date) return;
                    var belt = prompt('Belt-level eligibility', exam.belt);
                    if (!belt) return;
                    apiCall('PUT', '/api/exams/' + id, { title: title, grade_info: gradeInfo, date: date, belt: belt })
                        .then(function () { loadExams(); })
                        .catch(console.error);
                }).catch(console.error);
            };

            window.deleteExam = function (id) {
                if (!confirm('Delete this exam?')) return;
                apiCall('DELETE', '/api/exams/' + id)
                    .then(function () { loadExams(); })
                    .catch(console.error);
            };

            // Announcements
            function loadAnnouncements() {
                apiCall('GET', '/api/announcements').then(function (rows) {
                    renderAnnouncements(rows);
                    updateDashboardStats();
                }).catch(console.error);
            }

            function renderAnnouncements(data) {
                var adminList = document.getElementById('admin-announcements-list');
                var studentList = document.getElementById('student-announcements-list');
                if (adminList) adminList.innerHTML = '';
                if (studentList) studentList.innerHTML = '';
                data.forEach(function (a) {
                    var liHtml = '<li class="activity-item"><div class="activity-avatar">AN</div><div class="activity-content"><h4 class="activity-title">Announcement</h4><p class="activity-desc">' + a.text + '</p><span class="activity-time">' + new Date(a.created_at).toLocaleString() + '</span></div></li>';
                    var adminLiHtml = '<li class="activity-item"><div class="activity-avatar">AN</div><div class="activity-content"><h4 class="activity-title">Announcement</h4><p class="activity-desc">' + a.text + '</p><span class="activity-time">' + new Date(a.created_at).toLocaleString() + '</span></div><button class="btn btn-primary" onclick="deleteAnnouncement(' + a.id + ')">Delete</button></li>';
                    if (adminList) adminList.insertAdjacentHTML('beforeend', adminLiHtml);
                    if (studentList) studentList.insertAdjacentHTML('beforeend', liHtml);
                });
                safeSetText('student-new-announcements', data.length);
            }

            window.postAnnouncement = function () {
                var textarea = document.getElementById('announcementText');
                if (!textarea) return;
                var text = textarea.value.trim();
                if (!text) return;
                apiCall('POST', '/api/announcements', { text: text })
                    .then(function () {
                        textarea.value = '';
                        loadAnnouncements();
                    })
                    .catch(console.error);
            };

            window.deleteAnnouncement = function (id) {
                if (!confirm('Delete this announcement?')) return;
                apiCall('DELETE', '/api/announcements/' + id)
                    .then(function () { loadAnnouncements(); })
                    .catch(console.error);
            };

            
            // Tournament Registrations
            function loadTournamentRegistrations() {
                apiCall('GET', '/api/tournament-registrations').then(function (rows) {
                    renderTournamentRegistrations(rows);
                }).catch(console.error);
            }

            function renderTournamentRegistrations(data) {
                var tbody = document.querySelector('#admin-tournament-registrations-table tbody');
                if (!tbody) return;
                tbody.innerHTML = '';
                data.forEach(function (tr) {
                    var tr_el = document.createElement('tr');
                    tr_el.innerHTML = '<td>' + tr.tournament_title + '</td><td>' + tr.name + '</td><td>' + tr.email + '</td><td>' + tr.phone + '</td><td>' + tr.centre + '</td><td>' + tr.batch + '</td><td>' + tr.created_at + '</td><td><button class="btn btn-primary" onclick="deleteTournamentRegistration(' + tr.id + ')">Delete</button></td>';
                    tbody.appendChild(tr_el);
                });
            }

            window.deleteTournamentRegistration = function (id) {
                if (!confirm('Delete this tournament registration?')) return;
                apiCall('DELETE', '/api/tournament-registrations/' + id)
                    .then(function () { loadTournamentRegistrations(); })
                    .catch(console.error);
            };

            // Exam Registrations
            function loadExamRegistrations() {
                apiCall('GET', '/api/exam-registrations').then(function (rows) {
                    renderExamRegistrations(rows);
                }).catch(console.error);
            }

            function renderExamRegistrations(data) {
                var tbody = document.querySelector('#admin-exam-registrations-table tbody');
                if (!tbody) return;
                tbody.innerHTML = '';
                data.forEach(function (er) {
                    var tr_el = document.createElement('tr');
                    tr_el.innerHTML = '<td>' + er.exam_title + '</td><td>' + er.name + '</td><td>' + er.email + '</td><td>' + er.phone + '</td><td>' + er.centre + '</td><td>' + er.batch + '</td><td>' + er.created_at + '</td><td>' + er.exam_belt + '</td><td><button class="btn btn-primary" onclick="deleteExamRegistration(' + er.id + ')">Delete</button></td>';
                    tbody.appendChild(tr_el);
                });
            }

            window.deleteExamRegistration = function (id) {
                if (!confirm('Delete this exam registration?')) return;
                apiCall('DELETE', '/api/exam-registrations/' + id)
                    .then(function () { loadExamRegistrations(); })
                    .catch(console.error);
            };

            // Store Orders
            function loadStoreOrders() {
                apiCall('GET', '/api/store-orders').then(function (rows) {
                    renderStoreOrders(rows);
                }).catch(console.error);
            }

            function renderStoreOrders(data) {
                var tbody = document.querySelector('#admin-store-orders-table tbody');
                if (!tbody) return;
                tbody.innerHTML = '';
                data.forEach(function (so) {
                    var tr_el = document.createElement('tr');
                    var statusOptions = '<select onchange="updateStoreOrderStatus(' + so.id + ', this.value)"><option value="Pending" ' + (so.status === 'Pending' ? 'selected' : '') + '>Pending</option><option value="Confirmed" ' + (so.status === 'Confirmed' ? 'selected' : '') + '>Confirmed</option><option value="Delivered" ' + (so.status === 'Delivered' ? 'selected' : '') + '>Delivered</option></select>';
                    tr_el.innerHTML = '<td>' + so.item_name + '</td><td>' + so.name + '</td><td>' + so.email + '</td><td>' + so.phone + '</td><td>' + so.centre + '</td><td>' + so.batch + '</td><td>' + so.quantity + '</td><td>' + so.total_price + '</td><td>' + statusOptions + '</td><td>' + so.created_at + '</td><td><button class="btn btn-primary" onclick="deleteStoreOrder(' + so.id + ')">Delete</button></td>';
                    tbody.appendChild(tr_el);
                });
            }

            window.updateStoreOrderStatus = function (id, status) {
                apiCall('PUT', '/api/store-orders/' + id, { status: status })
                    .then(function () { loadStoreOrders(); })
                    .catch(console.error);
            };

            window.deleteStoreOrder = function (id) {
                if (!confirm('Delete this store order?')) return;
                apiCall('DELETE', '/api/store-orders/' + id)
                    .then(function () { loadStoreOrders(); })
                    .catch(console.error);
            };

            // Dashboard stats
            function updateDashboardStats() {
                apiCall('GET', '/api/dashboard/admin').then(function (stats) {
                    safeSetText('admin-new-admissions', stats.newAdmissions);
                    safeSetText('admin-tournaments-registered', stats.tournamentsRegistered);
                    safeSetText('admin-upcoming-exams', stats.upcomingExams);
                                    }).catch(console.error);

                apiCall('GET', '/api/dashboard/student').then(function (stats) {
                    safeSetText('student-registered-tournaments', stats.registeredTournaments);
                    safeSetText('student-upcoming-exams', stats.upcomingExams);
                    safeSetText('student-new-announcements', stats.newAnnouncements);
                    safeSetText('student-store-items', stats.storeItems);
                }).catch(console.error);
            }

            // Admission form to DB
            function submitAdmissionToDB(formData) {
                apiCall('POST', '/api/admissions', formData)
                    .then(function () {
                        window.showModal('successModal');
                        document.getElementById('admissionForm').reset();
                    })
                    .catch(function (err) {
                        console.error('Admission submission error', err);
                        alert('Error submitting admission: ' + (err.message || 'Please try again.'));
                    });
            }

            // Registration modal functions
            window.showTournamentRegistrationModal = function(tournamentId, tournamentTitle) {
                document.getElementById('tournamentId').value = tournamentId;
                document.getElementById('tournamentTitle').value = tournamentTitle;
                document.getElementById('tournamentRegistrationForm').reset();
                document.getElementById('tournamentTitle').value = tournamentTitle;
                window.showModal('tournamentRegistrationModal');
            };

            window.submitTournamentRegistration = function() {
                var form = document.getElementById('tournamentRegistrationForm');
                var formData = new FormData(form);
                var data = {
                    tournament_id: document.getElementById('tournamentId').value,
                    name: formData.get('name'),
                    email: formData.get('email'),
                    phone: formData.get('phone'),
                    centre: formData.get('centre'),
                    batch: formData.get('batch')
                };
                
                if (!data.name || !data.email || !data.phone || !data.centre || !data.batch) {
                    alert('Please fill all required fields');
                    return;
                }
                
                apiCall('POST', '/api/tournament-registrations', data)
                    .then(function() {
                        window.closeModal('tournamentRegistrationModal');
                        alert('Tournament registration successful!');
                    })
                    .catch(function(err) {
                        console.error('Tournament registration error', err);
                        alert('Error registering for tournament. Please try again.');
                    });
            };

            window.showExamRegistrationModal = function(examId, examTitle) {
                document.getElementById('examId').value = examId;
                document.getElementById('examTitle').value = examTitle;
                document.getElementById('examRegistrationForm').reset();
                document.getElementById('examTitle').value = examTitle;
                window.showModal('examRegistrationModal');
            };

            window.submitExamRegistration = function() {
                var form = document.getElementById('examRegistrationForm');
                var formData = new FormData(form);
                var data = {
                    exam_id: document.getElementById('examId').value,
                    name: formData.get('name'),
                    email: formData.get('email'),
                    phone: formData.get('phone'),
                    centre: formData.get('centre'),
                    batch: formData.get('batch')
                };
                
                if (!data.name || !data.email || !data.phone || !data.centre || !data.batch) {
                    alert('Please fill all required fields');
                    return;
                }
                
                apiCall('POST', '/api/exam-registrations', data)
                    .then(function() {
                        window.closeModal('examRegistrationModal');
                        alert('Exam registration successful!');
                    })
                    .catch(function(err) {
                        console.error('Exam registration error', err);
                        alert('Error registering for exam. Please try again.');
                    });
            };

            window.showStoreOrderModal = function(itemId, itemName, itemPrice) {
                document.getElementById('storeItemId').value = itemId;
                document.getElementById('itemName').value = itemName;
                document.getElementById('itemPrice').value = itemPrice;
                document.getElementById('storeOrderForm').reset();
                document.getElementById('itemName').value = itemName;
                document.getElementById('itemPrice').value = itemPrice;
                window.showModal('storeOrderModal');
            };

            window.submitStoreOrder = function() {
                var form = document.getElementById('storeOrderForm');
                var formData = new FormData(form);
                var data = {
                    store_item_id: document.getElementById('storeItemId').value,
                    name: formData.get('name'),
                    email: formData.get('email'),
                    phone: formData.get('phone'),
                    centre: formData.get('centre'),
                    batch: formData.get('batch'),
                    quantity: formData.get('quantity')
                };
                
                if (!data.name || !data.email || !data.phone || !data.centre || !data.batch || !data.quantity) {
                    alert('Please fill all required fields');
                    return;
                }
                
                apiCall('POST', '/api/store-orders', data)
                    .then(function() {
                        window.closeModal('storeOrderModal');
                        alert('Store order placed successfully!');
                    })
                    .catch(function(err) {
                        console.error('Store order error', err);
                        alert('Error placing order. Please try again.');
                    });
            };

            document.addEventListener('DOMContentLoaded', function () {
                // Initial section
                window.showSection('home');

                // Load home page dynamic content
                loadHomeInstructors();
                loadHomeCourses();

                // Mobile navigation toggle
                var hamburger = document.getElementById('hamburger');
                var navLinksEl = document.getElementById('navLinks');
                var overlayEl = document.getElementById('overlay');
                if (hamburger && navLinksEl && overlayEl) {
                    hamburger.addEventListener('click', function () {
                        navLinksEl.classList.toggle('active');
                        overlayEl.classList.toggle('active');
                    });
                    overlayEl.addEventListener('click', function () {
                        navLinksEl.classList.remove('active');
                        overlayEl.classList.remove('active');
                    });
                }

                // Login form -> authenticate with API
                var loginForm = document.getElementById('loginForm');
                if (loginForm) {
                    loginForm.addEventListener('submit', async function (e) {
                        e.preventDefault();
                        
                        var email = document.getElementById('email').value;
                        var password = document.getElementById('password').value;
                        var roleEl = document.getElementById('role');
                        var role = roleEl ? roleEl.value : 'student';
                        
                        // Disable login button to prevent multiple submissions
                        var loginButton = loginForm.querySelector('.btn-login');
                        var originalText = loginButton.textContent;
                        loginButton.disabled = true;
                        loginButton.textContent = 'Logging in...';
                        
                        try {
                            const response = await fetch('/api/login', {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json',
                                },
                                body: JSON.stringify({ email, password, role })
                            });
                            
                            const data = await response.json();
                            
                            if (data.success) {
                                // Store JWT token and user info
                                localStorage.setItem('authToken', data.token);
                                sessionStorage.setItem('currentUser', JSON.stringify(data.user));
                                
                                // Show success message (non-blocking)
                                console.log(data.message || 'Login successful!');
                                
                                // Redirect to appropriate dashboard
                                if (role === 'admin') {
                                    console.log('Redirecting to admin dashboard...');
                                    window.showSection('admin-dashboard');
                                    // Load initial admin dashboard stats
                                    updateDashboardStats();
                                } else {
                                    console.log('Redirecting to student dashboard...');
                                    window.showSection('student-dashboard');
                                    updateDashboardStats();
                                }
                                
                                // Clear form
                                loginForm.reset();
                            } else {
                                // Show error message
                                console.error('Login failed:', data.message);
                                alert(data.message || 'Login failed. Please try again.');
                            }
                        } catch (error) {
                            console.error('Login error:', error);
                            alert('Login error occurred. Please check your connection and try again.');
                        } finally {
                            // Re-enable login button
                            loginButton.disabled = false;
                            loginButton.textContent = originalText;
                        }
                    });
                }

                // Student Registration form -> submit to DB
                var studentRegistrationForm = document.getElementById('studentRegistrationForm');
                if (studentRegistrationForm) {
                    studentRegistrationForm.addEventListener('submit', async function (e) {
                        e.preventDefault();
                        
                        var firstName = document.getElementById('studentFirstName').value;
                        var lastName = document.getElementById('studentLastName').value;
                        var email = document.getElementById('studentEmail').value;
                        var phone = document.getElementById('studentPhone').value;
                        var batch = document.getElementById('studentBatch').value;
                        
                        // Disable register button to prevent multiple submissions
                        var registerButton = studentRegistrationForm.querySelector('.btn-primary');
                        var originalText = registerButton.textContent;
                        registerButton.disabled = true;
                        registerButton.textContent = 'Registering...';
                        
                        try {
                            const response = await fetch('/api/student-register', {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json',
                                },
                                body: JSON.stringify({ firstName, lastName, email, phone, batch })
                            });
                            
                            const data = await response.json();
                            
                            if (response.ok) {
                                alert(data.message || 'Registration successful! Please check your email to verify your account.');
                                studentRegistrationForm.reset();
                                showSection('login');
                            } else {
                                alert(data.message || 'Registration failed. Please try again.');
                            }
                        } catch (error) {
                            console.error('Registration error:', error);
                            alert('Registration error occurred. Please check your connection and try again.');
                        } finally {
                            // Re-enable register button
                            registerButton.disabled = false;
                            registerButton.textContent = originalText;
                        }
                    });
                }

                // Admission form -> submit to DB
                var admissionForm = document.getElementById('admissionForm');
                if (admissionForm) {
                    admissionForm.addEventListener('submit', function (e) {
                        e.preventDefault();
                        
                        // Handle photo upload
                        var photoInput = document.getElementById('photo');
                        var photoPromise = Promise.resolve('');
                        
                        if (photoInput && photoInput.files && photoInput.files[0]) {
                            var file = photoInput.files[0];
                            if (file.size > 2 * 1024 * 1024) { // 2MB limit
                                alert('Photo size must be less than 2MB');
                                return;
                            }
                            
                            photoPromise = new Promise(function(resolve) {
                                var reader = new FileReader();
                                reader.onload = function(e) {
                                    var img = new Image();
                                    img.onload = function() {
                                        // Create canvas for compression
                                        var canvas = document.createElement('canvas');
                                        var ctx = canvas.getContext('2d');
                                        
                                        // Calculate new dimensions (max 800px width/height)
                                        var maxWidth = 800;
                                        var maxHeight = 800;
                                        var width = img.width;
                                        var height = img.height;
                                        
                                        if (width > height) {
                                            if (width > maxWidth) {
                                                height *= maxWidth / width;
                                                width = maxWidth;
                                            }
                                        } else {
                                            if (height > maxHeight) {
                                                width *= maxHeight / height;
                                                height = maxHeight;
                                            }
                                        }
                                        
                                        canvas.width = width;
                                        canvas.height = height;
                                        
                                        // Draw and compress
                                        ctx.drawImage(img, 0, 0, width, height);
                                        resolve(canvas.toDataURL('image/jpeg', 0.7)); // 70% quality
                                    };
                                    img.src = e.target.result;
                                };
                                reader.readAsDataURL(file);
                            });
                        }
                        
                        photoPromise.then(function(photoData) {
                            var formData = {
                                first_name: document.getElementById('firstName').value,
                                last_name: document.getElementById('lastName').value,
                                email: document.getElementById('emailAdmission').value,
                                phone: document.getElementById('phone').value,
                                age: document.getElementById('age').value,
                                belt_level: document.getElementById('beltLevel').value,
                                address: document.getElementById('address').value,
                                centre: document.getElementById('centre').value,
                                batch_timing: document.getElementById('batchTiming').value,
                                photo_url: photoData
                            };
                            submitAdmissionToDB(formData);
                        });
                    });
                }

                // Photo preview for admission form
                var photoInput = document.getElementById('photo');
                if (photoInput) {
                    photoInput.addEventListener('change', function (e) {
                        var file = e.target.files && e.target.files[0];
                        if (!file) return;
                        
                        // Check file size
                        if (file.size > 2 * 1024 * 1024) {
                            alert('Photo size must be less than 2MB');
                            photoInput.value = '';
                            return;
                        }
                        
                        var reader = new FileReader();
                        reader.onload = function (evt) {
                            var label = document.querySelector('.file-upload-label');
                            if (!label) return;
                            
                            // Create preview
                            label.innerHTML = `
                                <img src="${evt.target.result}" alt="Photo Preview" style="width: 100%; max-height: 200px; object-fit: cover; border-radius: 8px;">
                                <div class="file-upload-text" style="margin-top: 10px;">Click to change photo</div>
                                <div class="file-upload-hint">${file.name}</div>
                            `;
                        };
                        reader.readAsDataURL(file);
                    });
                }

            });

            window.updateDashboardStats = async function () {
                var user = JSON.parse(sessionStorage.getItem('currentUser') || '{}');
                if (!user.role) return;

                try {
                    const response = await authenticatedFetch(`/api/dashboard/${user.role}`);
                    const stats = await response.json();
                    
                    if (response.ok) {
                        // Update admin dashboard
                        if (user.role === 'admin') {
                            var totalInstructorsEl = document.getElementById('totalInstructors');
                            var totalBatchesEl = document.getElementById('totalBatches');
                            var totalAdmissionsEl = document.getElementById('totalAdmissions');
                            var totalPaymentsEl = document.getElementById('totalPayments');
                            var totalTournamentsEl = document.getElementById('totalTournaments');
                            var totalStoreItemsEl = document.getElementById('totalStoreItems');
                            var totalExamsEl = document.getElementById('totalExams');
                            var totalAnnouncementsEl = document.getElementById('totalAnnouncements');
                            
                            if (totalInstructorsEl) totalInstructorsEl.textContent = stats.totalInstructors || 0;
                            if (totalBatchesEl) totalBatchesEl.textContent = stats.totalBatches || 0;
                            if (totalAdmissionsEl) totalAdmissionsEl.textContent = stats.totalAdmissions || 0;
                            if (totalPaymentsEl) totalPaymentsEl.textContent = stats.totalPayments || 0;
                            if (totalTournamentsEl) totalTournamentsEl.textContent = stats.totalTournaments || 0;
                            if (totalStoreItemsEl) totalStoreItemsEl.textContent = stats.totalStoreItems || 0;
                            if (totalExamsEl) totalExamsEl.textContent = stats.totalExams || 0;
                            if (totalAnnouncementsEl) totalAnnouncementsEl.textContent = stats.totalAnnouncements || 0;
                                                    }
                        
                        // Update student dashboard
                        if (user.role === 'student') {
                            var upcomingTournamentsEl = document.getElementById('upcomingTournaments');
                            var upcomingExamsEl = document.getElementById('upcomingExams');
                            var newAnnouncementsEl = document.getElementById('newAnnouncements');
                            var storeItemsEl = document.getElementById('storeItems');

                            if (upcomingTournamentsEl) upcomingTournamentsEl.textContent = stats.upcomingTournaments || 0;
                            if (upcomingExamsEl) upcomingExamsEl.textContent = stats.upcomingExams || 0;
                            if (newAnnouncementsEl) newAnnouncementsEl.textContent = stats.newAnnouncements || 0;
                            if (storeItemsEl) storeItemsEl.textContent = stats.storeItems || 0;
                        }
                    } else {
                        console.error('Failed to fetch dashboard stats:', stats.message);
                        // If token is invalid, logout
                        if (stats.message && stats.message.includes('token')) {
                            logout();
                        }
                    }
                } catch (error) {
                    console.error('Error fetching dashboard stats:', error);
                }
            };
        })();
    </script>

</body>
</html>